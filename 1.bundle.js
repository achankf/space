(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[,function(t,e,s){"use strict";s.r(e);var n=s(3),r=s(4),i=s(7);const o=40,a=1,c=10,h=40,l=2*Math.PI,u=[0,1,2,3],d=[{kind:0,tabId:Symbol()},{kind:3,tabId:Symbol()},{kind:4,tabId:Symbol()},{kind:5,tabId:Symbol()},{kind:6,tabId:Symbol()},{kind:2,tabId:Symbol()}];class f{constructor(t){this.galaxyViewData={center:[0,0],gridSize:a},this.cacheSearchResult=[],this.subscribers=new Set,this.flags=new Set,this.reset(t)}reset(t){this.galaxy=t.galaxy;const e=d.slice(),s=e[0].tabId;this.curTabId=s,this.setTabsHelper(e),this.cacheSearchResult=[],this.notify(...u)}set searchName(t){clearInterval(this.searchNameId),this.searchNameId=setInterval(()=>{this.cacheSearchResult=this.galaxy.interop_search_name(t),this.notify(3),clearInterval(this.searchNameId)},300)}get searchNameResult(){return this.cacheSearchResult}get tabId(){return this.curTabId}set tabId(t){this.switchTabHelper(t),this.notify()}calDrawData(t,e,s,n,r){return this.galaxy.interop_cal_draw_data(t,e,s,n,r)}getPlanetName(t){return this.galaxy.get_planet_name(t.Planet)}handleCoorSearch(t,e){const s=this.galaxy.interop_search(t,e),n=s.map(t=>{return{id:t.id,name:t.name}});switch(n.length){case 0:break;case 1:const t=s[0].id;if(void 0!==t)if(void 0!==t.Planet){const e=t;this.switchPlanetTab(e)}else{if(void 0===t.Star)throw new Error("not handled");console.log(n)}break;default:this.cacheSearchResult=n,console.assert(!1)}}get tabs(){return this.tabState.slice()}getPlanetEdges(t){return this.galaxy.get_planet_edges(t)}getPlanetPoints(t){const e=this.galaxy.get_planet_points(t),s=2*this.galaxy.cal_planet_dim(t),n=new Float32Array(i.pb.buffer,e,s);return console.assert(n.length>0),n}addPlanetTab(t){const e=this.tabState,s=e.find(e=>1===e.kind&&e.planetId.Planet===t.Planet);if(void 0!==s)return s.tabId;const n=Symbol();return e.push({kind:1,planetId:t,tabId:n}),this.setTabsHelper(e),n}switchPlanetTab(t){console.log("switching view to planet id:",t);const e=this.addPlanetTab(t);this.switchTabHelper(e),this.notify()}moveTabToFront(t){const e=d.length,s=this.tabState.slice(0,e);if(s.some(e=>e.tabId===t))return;const n=this.tabState.find(e=>e.tabId===t);console.assert(void 0!==n);const r=this.tabState.slice(e).filter(e=>e.tabId!==t);this.tabState=[...s,n,...r];const i=e+10,o=this.tabState.length;o>i&&(console.assert(o===i+1),this.tabState.pop())}get data(){return{galaxy:this.galaxy}}tick(){this.galaxy=this.galaxy.cal_next_state(),this.notify(0)}addFlags(...t){Object(r.unionMut)(this.flags,...t)}notify(...t){this.addFlags(...t);for(const t of this.subscribers)t.update(this.flags);this.flags.clear()}add(...t){for(const e of t)console.assert(!this.subscribers.has(e),"double-subscribing the same subscriber"),this.subscribers.add(e);this.notify(...u)}delete(t){const e=this.subscribers.delete(t);console.assert(e,"unsubscribing a non-exist subscriber"),this.notify(...u)}clear(){this.subscribers.clear(),this.notify(...u)}setTabsHelper(t){console.assert(null!==t&&void 0!==t),this.tabState=t.slice(),this.addFlags(1)}switchTabHelper(t){const e=this.tabState.some(e=>e.tabId===t);console.assert(e),this.curTabId!==t&&(this.curTabId=t,this.addFlags(2))}}const p=1e3/Object(n.o)();console.log(p);const g=Object.keys(n.c).filter(t=>"number"==typeof n.c[t]).map(t=>Number(n.c[t])).sort((t,e)=>t-e);try{g.slice().map(t=>(function(t){switch(t){case n.c.Accessory:return"Accessory";case n.c.Apparel:return"Apparel";case n.c.Crop:return"Crop";case n.c.Metal:return"Metal";case n.c.Concrete:return"Concrete";case n.c.Supply:return"Supply";case n.c.Alloy:return"Alloy";case n.c.Gem:return"Gem";case n.c.Fuel:return"Fuel";case n.c.Fiber:return"Fiber";case n.c.Chemical:return"Chemical";case n.c.Circuit:return"Circuit";case n.c.Computer:return"Computer";case n.c.Food:return"Food";case n.c.Medicine:return"Medicine";case n.c.Furniture:return"Furniture";case n.c.Vehicle:return"Vehicle";case n.c.Machine:return"Machine";case n.c.Tool:return"Tool";case n.c.Hull:return"Hull";case n.c.Engine:return"Engine";case n.c.Weapon:return"Weapon";case n.c.Shield:return"Shield";case n.c.Armor:return"Armor";case n.c.Countermeasure:return"Countermeasure";case n.c.Rifle:return"Rifle";case n.c.Uniform:return"Uniform";case n.c.Saber:return"Saber";case n.c.Exoskeleton:return"Exoskeleton";default:throw new Error("not handled")}})(t))}catch(t){console.assert(!1,"sanity check failed")}var m=s(54);class w{constructor(t,e){this.canvas=t,this.viewData=e}toVpCoor([t,e]){console.assert(Number.isFinite(t)),console.assert(Number.isFinite(e));const s=this.viewData,{center:n,gridSize:r}=s,i=this.canvas,o=i.width,a=i.height,[c,h]=n,l=o/2,u=a/2,d=Math.floor((t+c)*r+l),f=Math.floor((e+h)*r+u);return console.assert(Number.isFinite(d)),console.assert(Number.isFinite(f)),[d,f]}toGameCoor([t,e]){const{center:s,gridSize:n}=this.viewData,r=this.canvas,i=r.width/2,o=r.height/2,[a,c]=s;return[(t-i)/n-a,(e-o)/n-c]}vpCenter(){const t=this.viewData,{center:e}=t;return this.toVpCoor(e)}isCircleInView(t,e){const s=2*e,n=Object(r.subtract)(t,[e,e]);return this.isRectInView(n,s,s)}isPointInView([t,e]){return t>=0&&t<=this.canvas.width&&e>=0&&e<=this.canvas.height}isSegmentIntersectSegment(t,e,s,n){const i=Object(r.subtract)(e,t);console.assert(Object(r.norm)(i)>0);const o=Object(r.subtract)(n,s);console.assert(Object(r.norm)(o)>0);const a=Object(r.subtract)(t,s),c=Object(r.determinant)(a,i),h=Object(r.determinant)(i,o);if(0===c&&0===h){const t=Object(r.dot)(i,i),e=Object(r.dot)(o,i),s=Object(r.dot)(a,i)/t,n=s+e/t;return s>=0&&s<=1||n>=0&&n<=1}if(0===h)return!1;const l=Object(r.determinant)(a,o)/h,u=c/h;return l>=0&&l<=1&&u>=0&&u<=1}isSegmentInView(t,e){const s=this.canvas,n=s.width,r=s.height;return this.isSegmentIntersectSegment(t,e,[0,0],[0,n])||this.isSegmentIntersectSegment(t,e,[0,0],[0,r])||this.isSegmentIntersectSegment(t,e,[n,0],[0,r])||this.isSegmentIntersectSegment(t,e,[n,0],[n,r])}isRectInView(t,e,s){const n=this.canvas,r=n.width,i=n.height,[o,a]=t;return 0<o+e&&r>o&&0<a+s&&i>a}getOffsetFromTopLeft(t){const e=t.target.getBoundingClientRect();return[t.center.x-e.left,t.center.y-e.top]}getOffsetFromCenter(t){const e=this.canvas;return[t.center.x-e.offsetLeft-e.width/2,t.center.y-e.offsetTop-e.height/2]}panTo(t){const e=this.viewData,s=this.vpCenter(),n=this.toGameCoor(s),i=Object(r.add)(t,s),o=this.toGameCoor(i),a=Object(r.subtract)(o,n),c=Object(r.norm)(a);let h=0;const l=c/30;return()=>{if(c<1||30==++h)return!0;const t=Object(r.project)(a,l);return e.center=Object(r.subtract)(e.center,t),!1}}zoom(t,e=a,s=o){console.assert(e<=s);const n=this.viewData,r=t.deltaY<0,i=n.gridSize;n.gridSize=r?Math.min(s,i+1):Math.max(e,i-1)}}w.planetVertexDist=Object(n.n)();class b extends HTMLCanvasElement{constructor(t){super(),this.db=t,this.ctx=this.getContext("2d"),this.cachedGrid=document.createElement("canvas"),this.shouldUpdateGrid=!0,this.shouldRedrawView=!0,this.draw=(()=>{this.resizeCanvas(),this.updatePanAnimation&&(this.updatePanAnimation()&&(this.updatePanAnimation=void 0),this.shouldUpdateGrid=!0,this.shouldRedrawView=!0),this.shouldUpdateGrid&&this.updateCachedGrid();const t=this.ctx;this.shouldRedrawView&&0!==this.width&&0!==this.height&&(t.clearRect(0,0,this.width,this.height),t.drawImage(this.cachedGrid,0,0),this.drawObjects()),this.shouldRedrawView=!1,this.shouldUpdateGrid=!1,this.frameRequestId=requestAnimationFrame(this.draw)}),this.resizeCanvas=(()=>{const t=this,e=t.clientWidth,s=t.clientHeight;t.width===e&&t.height===s||(t.width=e,t.height=s,this.cachedGrid.width=e,this.cachedGrid.height=s,this.shouldUpdateGrid=!0,this.shouldRedrawView=!0)}),this.doubleClick=(t=>{const e=this.getOffsetFromCenter(t);this.panTo(e)}),this.singleClick=(t=>{const e=this.getOffsetFromTopLeft(t),[s,n]=this.operator.toGameCoor(e);this.db.handleCoorSearch(s,n)}),this.wheel=(t=>{this.updatePanAnimation=void 0,this.operator.zoom(t),this.shouldUpdateGrid=!0,this.shouldRedrawView=!0}),this.pan=(t=>{this.panTo([t.deltaX,t.deltaY])}),console.assert(void 0!==this.ctx);this.className="map",window.addEventListener("resize",this.resizeCanvas,!0);const e=new m.Manager(this),s=new m.Tap({event:"doubletap",taps:2}),n=new m.Tap({event:"singletap"}),r=(new m.Pan).set({direction:m.DIRECTION_ALL});e.add([s,n,r]),s.recognizeWith(n),n.requireFailure(s),e.on("singletap",this.singleClick),e.on("doubletap",this.doubleClick),e.on("pan",this.pan),this.addEventListener("wheel",this.wheel,{passive:!0}),this.operator=new w(this,t.galaxyViewData),this.draw()}update(t){t.has(0)&&(this.shouldRedrawView=!0)}suspend(){if(void 0===this.frameRequestId)throw console.assert(!1),new Error("no need to suspend drawing");window.cancelAnimationFrame(this.frameRequestId),this.frameRequestId=void 0}resume(){if(void 0!==this.frameRequestId)throw console.assert(!1),new Error("no need to resume drawing");this.draw()}getOffsetFromTopLeft(t){const e=t.target.getBoundingClientRect();return[t.center.x-e.left,t.center.y-e.top]}getOffsetFromCenter(t){return[t.center.x-this.width/2,t.center.y-this.height/2]}drawPlanet(t,e,s,n){const i=s*this.db.galaxyViewData.gridSize,o=this.ctx;o.save();const a=this.operator.toVpCoor(e),[c,h]=a;console.assert(void 0!==n);const u=this.operator.toVpCoor(n),d=Object(r.distance)(u,a),[f,p]=u;this.isCircleInView(u,d)&&(o.beginPath(),o.arc(f,p,d,0,l),o.stroke()),this.isCircleInView(a,i)&&(o.beginPath(),o.arc(c,h,i,0,l),o.fill());const g=o.measureText(t),m=g.width,w=c,b=h-i-5,y=Object(r.subtract)([w,b],[m/2,10]);this.isRectInView(y,g.width,20)&&o.fillText(t,w,b),o.restore()}isCircleInView(t,e){const s=2*e,n=Object(r.subtract)(t,[e,e]);return this.isRectInView(n,s,s)}isRectInView(t,e,s){const n=this.width,r=this.height,[i,o]=t;return 0<i+e&&n>i&&0<o+s&&r>o}drawStar(t,e,s,n){const i=this.db.galaxyViewData.gridSize,o=this.ctx,[a,c]=this.operator.toVpCoor([s,n]),h=Math.max(1,e*i);o.beginPath(),o.arc(a,c,h,0,l),o.fill();const u=o.measureText(t),d=u.width,f=a,p=c-h-5,g=Object(r.subtract)([f,p],[d/2,10]);this.isRectInView(g,u.width,20)&&o.fillText(t,f,p)}drawShip(t,e,s){const n=this.db.galaxyViewData.gridSize,r=this.ctx,[i,o]=this.operator.toVpCoor([e,s]),a=Math.max(1,t*n);a<1||(r.beginPath(),r.arc(i,o,a,0,l),r.fill())}drawObjects(){const t=this.db,e=t.galaxyViewData.gridSize,[s,r]=this.operator.toGameCoor([0,0]),[i,o]=this.operator.toGameCoor([this.width,this.height]),a=t.calDrawData(s,r,i,o,e),c=this.ctx;c.save(),c.fillStyle="yellow",c.textAlign="center",c.textBaseline="middle";for(const{name:t,radius:e,x:s,y:n}of a.stars)this.drawStar(t,e,s,n);c.strokeStyle="white",c.setLineDash([5,3]),c.fillStyle="green",c.textAlign="center",c.textBaseline="middle";for(const{name:t,radius:e,x:s,y:n,cx:r,cy:i}of a.planets){const o=[s,n],a=[r,i];this.drawPlanet(t,o,e,a)}for(const{kind:t,radius:e,x:s,y:r}of a.ships)console.log("{0} {1}",t,n.d[t]),this.drawShip(e,s,r);c.restore()}updateCachedGrid(){const t=this.cachedGrid,e=t.getContext("2d");if(!e)throw new Error("cannot create context");const s=this.db.galaxyViewData,n=s.gridSize,r=s.center;e.clearRect(0,0,t.width,t.height),e.save(),e.lineWidth=1,e.strokeStyle="#0c0c0c",e.translate(.5,.5);const[i,o]=r,a=Math.floor(i),l=Math.floor(o),[u,d]=this.operator.toVpCoor([a,l]);if(e.beginPath(),n>=c){const s=Math.ceil(this.width/n);let r=u%n;for(let i=0;i<=s;i++)e.moveTo(r,0),e.lineTo(r,t.height),r+=n;const i=Math.ceil(this.height/n);let o=d%n;for(let s=0;s<=i;s++)e.moveTo(0,o),e.lineTo(t.width,o),o+=n}e.stroke(),e.restore(),e.save(),e.translate(.5,.5),e.strokeStyle=n>=c?"#282828":"#0c0c0c";{const s=a-a%h,r=l-l%h,i=h*n,[o,c]=this.operator.toVpCoor([s,r]);e.beginPath();const u=Math.ceil(this.width/i);let d=o%i;for(let s=0;s<=u;s++)e.moveTo(d,0),e.lineTo(d,t.height),d+=i;const f=Math.ceil(this.height/i);let p=c%i;for(let s=0;s<=f;s++)e.moveTo(0,p),e.lineTo(t.width,p),p+=i;e.stroke()}e.restore()}panTo(t){this.updatePanAnimation=this.operator.panTo(t)}}function y(t){for(;t.lastChild;)t.removeChild(t.lastChild)}customElements.define("map-view",b,{extends:"canvas"});const v=document.getElementById("nationView");console.assert(null!==v);class _ extends HTMLElement{constructor(t){super(),this.db=t,this.attachShadow({mode:"open"}).appendChild(v.content.cloneNode(!0))}update(t){}}customElements.define("nation-view",_);const M=document.getElementById("peopleView");console.assert(null!==M);class S extends HTMLElement{constructor(t){super(),this.db=t,this.attachShadow({mode:"open"}).appendChild(M.content.cloneNode(!0))}update(t){}}customElements.define("people-view",S);const I=document.getElementById("planetView");function x(t){return"#"+(16777216+16777215*((1103515245*t+12345)%Math.pow(2,31))).toString(16).substr(1,6)}console.assert(null!==I);class C extends HTMLElement{constructor(t,e){super(),this.db=t,this.planetId=e,this.planetViewData={center:[0,0],gridSize:a},this.shouldRedrawView=!0,this.planetDim=this.db.galaxy.cal_planet_dim(this.planetId),this.doubleClick=(t=>{const e=this.operator.getOffsetFromCenter(t);this.panTo(e)}),this.singleClick=(t=>{const e=this.operator.getOffsetFromTopLeft(t),[s,n]=this.operator.toGameCoor(e),r=this.db.galaxy.cal_planet_click(this.planetId,s,n);console.log(r+" "+s+" "+n)}),this.resizeCanvas=(()=>{const t=this.canvas;this.canvas.style.height=400..toString(),this.canvas.style.width=400..toString(),400===t.width&&400===t.height||(t.width=400,t.height=400,this.shouldRedrawView=!0)}),this.draw=(()=>{if(this.resizeCanvas(),this.updatePanAnimation&&(this.updatePanAnimation()&&(this.updatePanAnimation=void 0),this.shouldRedrawView=!0),this.shouldRedrawView){const t=this.db.getPlanetPoints(this.planetId),e=[];for(let s=0;s<t.length;s+=2){const n=[t[s],t[s+1]],r=this.operator.toVpCoor(n);e.push({gameCoor:n,vpCoor:r})}const s=this.getColonizedMap();this.drawMap(e,s)}this.shouldRedrawView=!1,requestAnimationFrame(this.draw)}),this.drawMap=((t,e)=>{const s=this.ctx,n=this.db,o=n.galaxy,a=C.cityRadiusLimit*this.planetViewData.gridSize;s.clearRect(0,0,this.canvas.width,this.canvas.height),t.forEach(({gameCoor:[t,n],vpCoor:r},o)=>{if(e[o]<0)return;if(!this.operator.isCircleInView(r,a))return;const c=a/50;if(c>=1){const e=this.db.galaxy.cal_city_graph(this.planetId,o),r=e.num_structures;if(r>0){const o=new Float32Array(i.pb.buffer,e.get_points(),2*r),a=new Uint8Array(i.pb.buffer,e.get_dims(),2*r),h=new Uint32Array(i.pb.buffer,e.get_roads(),2*(r-1));s.save(),s.beginPath(),s.strokeStyle="gray",s.fillStyle="black",s.lineWidth=1;for(let e=0;e<h.length;e+=2){console.assert(h[e]!==h[e+1]);const r=2*h[e],i=2*h[e+1];console.assert(r!==i);const a=o[r],c=o[r+1],l=o[i],u=o[i+1];console.assert(Number.isFinite(a)),console.assert(Number.isFinite(l)),console.assert(Number.isFinite(c)),console.assert(Number.isFinite(u)),console.assert(a!==l&&c!==u);const[d,f]=this.operator.toVpCoor([t+a,n+c]),[p,g]=this.operator.toVpCoor([t+l,n+u]);d===p&&f===g||(s.moveTo(d,f),s.lineTo(p,g))}s.stroke();for(let e=0;e<o.length;e+=2){const r=o[e],i=o[e+1],h=Math.max(1,a[e]*c),l=Math.max(1,a[e+1]*c),[u,d]=this.operator.toVpCoor([t+r,n+i]);this.operator.isRectInView([u,d],h,l)&&s.rect(u,d,h,l)}s.fill(),s.restore()}e.free()}}),s.save();const c=n.getPlanetEdges(this.planetId);s.save(),s.beginPath(),s.strokeStyle="gray",s.fillStyle="white",s.lineWidth=2;for(let e=0;e<c.length;e+=2){const n=c[e],r=c[e+1],[i,o]=t[n].vpCoor,[a,h]=t[r].vpCoor;s.moveTo(i,o),s.lineTo(a,h)}s.stroke(),s.restore();s.save(),s.fillStyle="green",s.lineWidth=5,t.forEach(({vpCoor:t},n)=>{const r=e[n];if(0!==r)return;const[i,o]=t;this.operator.isCircleInView(t,10)&&(s.beginPath(),s.strokeStyle=x(r),s.arc(i,o,10,0,l),s.closePath(),s.stroke(),s.fill())}),s.restore(),s.save(),s.fillStyle="yellow",s.lineWidth=5,t.forEach(({vpCoor:t},n)=>{const r=e[n];if(r<0||0===r||o.is_at_war_with(0,r))return;const[i,a]=t;this.operator.isCircleInView(t,10)&&(s.beginPath(),s.strokeStyle=x(r),s.arc(i,a,10,0,l),s.closePath(),s.stroke(),s.fill())}),s.restore(),s.save(),s.fillStyle="red",s.lineWidth=5,s.beginPath(),t.forEach(({vpCoor:t},n)=>{const r=e[n];if(r<0||0===r||!o.is_at_war_with(0,r))return;const[i,a]=t;this.operator.isCircleInView(t,10)&&(s.beginPath(),s.strokeStyle=x(r),s.arc(i,a,10,0,l),s.closePath(),s.stroke(),s.fill())}),s.restore(),s.save(),s.fillStyle="white",s.beginPath(),t.forEach(({vpCoor:t},n)=>{if(e[n]>=0)return;const[r,i]=t;this.operator.isCircleInView(t,10)&&(s.arc(r,i,10,0,l),s.closePath())}),s.fill(),s.restore();s.save(),s.beginPath(),s.fillStyle="purple",t.map(({vpCoor:t},e)=>{if(!o.has_division(this.planetId,e))return;const[n,r]=t,i=[n,r-10],[a,c]=i;this.operator.isRectInView(i,5,10)&&s.rect(a,c,5,10)}),s.fill(),s.restore(),s.beginPath(),s.textAlign="center",t.map(({vpCoor:t},e)=>{const i=`${e}(${n.galaxy.get_city_idx(this.planetId,e)})`,o=s.measureText(i),a=o.width,[c,h]=t,l=c,u=h-8,d=Object(r.subtract)([l,u],[a/2,10]);this.operator.isRectInView(d,o.width,20)&&s.fillText(i,l,u)}),s.restore()}),this.pan=(t=>{this.panTo([t.deltaX,t.deltaY])}),this.wheel=(t=>{t.preventDefault(),this.updatePanAnimation=void 0,this.operator.zoom(t),this.shouldRedrawView=!0}),this.setClickTileIdx=(t=>()=>{this.tileId=t}),console.assert(this.planetDim>0);const s=this.attachShadow({mode:"open"});s.appendChild(I.content.cloneNode(!0)),this.canvas=s.querySelector(".map"),console.assert(null!==this.canvas),this.ctx=this.canvas.getContext("2d"),this.operator=new w(this.canvas,this.planetViewData),this.planetName=s.querySelector(".name"),console.assert(null!==this.canvas),this.tile=s.querySelector(".tile"),console.assert(null!==this.tile),this.polOwner=s.querySelector(".polOwner"),console.assert(null!==this.polOwner),this.container=s.querySelector(".container"),console.assert(null!==this.container);const n=new Hammer.Manager(this.canvas),o=new Hammer.Tap({event:"doubletap",taps:2}),c=new Hammer.Tap({event:"singletap"}),h=(new Hammer.Pan).set({direction:Hammer.DIRECTION_ALL});n.add([o,c,h]),o.recognizeWith(c),c.requireFailure(o),n.on("singletap",this.singleClick),n.on("doubletap",this.doubleClick),n.on("pan",this.pan),this.canvas.addEventListener("wheel",this.wheel),this.layout(),this.draw()}update(t){this.shouldRedrawView=!0}getColonizedMap(){return this.db.galaxy.get_colonized_map(this.planetId)}panTo(t){this.updatePanAnimation=this.operator.panTo(t)}layout(){y(this.canvas);this.planetId,this.db}}C.cityRadiusLimit=n.b.get_city_radius_limit(),customElements.define("planet-view",C);const k=document.getElementById("playerView");console.assert(null!==k);class P extends HTMLElement{constructor(t){super(),this.db=t,this.attachShadow({mode:"open"}).appendChild(k.content.cloneNode(!0))}update(t){}}customElements.define("player-view",P);const O=document.getElementById("searchView");console.assert(null!==O);const j=document.getElementById("resultItem");console.assert(null!==j);class E extends HTMLElement{constructor(t){super(),this.db=t,this.handleKeyup=(()=>{const t=this.db,e=this.searchTerm.value;t.searchName=e});const e=this.attachShadow({mode:"open"});e.appendChild(O.content.cloneNode(!0)),this.searchTerm=e.querySelector(".searchTerm"),console.assert(null!==this.searchTerm),this.searchTerm.onkeyup=this.handleKeyup,this.searchResult=e.querySelector(".result"),console.assert(null!==this.searchResult),this.refreshResults()}update(t){this.db;t.has(3)&&this.refreshResults()}refreshResults(){y(this.searchResult);const t=this.db,e=document.createDocumentFragment();for(const s of t.searchNameResult){const n=document.createDocumentFragment();n.appendChild(j.content.cloneNode(!0));const r=n.querySelector(".resultItem");console.assert(null!==r);const i=n.querySelector(".name");console.assert(null!==i),i.textContent=s.name;const o=s.id;if(void 0!==o.Planet){const e=o;r.onclick=(()=>t.switchPlanetTab(e))}else if(void 0!==o.Star);else if(void 0!==o.Nation);else if(void 0===o.Corporation)throw new Error("not handled");e.appendChild(n)}this.searchResult.appendChild(e)}}customElements.define("search-view",E);const T=document.getElementById("stationView");console.assert(null!==T);class V extends HTMLElement{constructor(t){super(),this.db=t;const e=this.attachShadow({mode:"open"});e.appendChild(T.content.cloneNode(!0)),this.tbody=e.querySelector(".map"),console.assert(null!==this.tbody),this.name=e.querySelector(".name"),console.assert(null!==this.tbody),this.layout()}update(t){this.updateHandler&&this.updateHandler(t)}layout(){y(this.tbody),function(t,e){const s=e.toString();t.textContent!==s&&(t.textContent=s)}(this.name,"Station 1");const t=document.createDocumentFragment();for(let e=0;e<1;e++){const e=document.createElement("tr");t.appendChild(e);for(let t=0;t<2;t++){const t=document.createElement("td");e.appendChild(t),t.textContent="A"}}this.tbody.appendChild(t)}}customElements.define("station-view",V);const z=document.getElementById("switchView");console.assert(null!==z);class R extends HTMLElement{constructor(t){super(),this.db=t,this.tabChildren=new Map,this.switch=(t=>{const e=this.db;if(void 0===this.curView)this.switchHelper(this.createGalaxyView());else switch(t.kind){case 0:this.curView.kind!==t.kind&&this.switchHelper(this.createGalaxyView());break;case 1:switch(this.curView.kind){case 1:if(this.curView.planetId===t.planetId)return;break;case 0:this.curView.view.suspend()}this.switchHelper(Object.assign({},t,{view:new C(e,t.planetId.Planet)}));break;case 2:switch(this.curView.kind){case 0:this.curView.view.suspend();break;case 2:return}this.switchHelper(Object.assign({},t,{view:new E(e)}));break;case 3:switch(this.curView.kind){case 0:this.curView.view.suspend();break;case 3:return}this.switchHelper(Object.assign({},t,{view:new P(e)}));break;case 4:switch(this.curView.kind){case 0:this.curView.view.suspend();break;case 4:return}this.switchHelper(Object.assign({},t,{view:new _(e)}));break;case 5:switch(this.curView.kind){case 0:this.curView.view.suspend();break;case 5:return}this.switchHelper(Object.assign({},t,{view:new V(e)}));break;case 6:switch(this.curView.kind){case 0:this.curView.view.suspend();break;case 6:return}this.switchHelper(Object.assign({},t,{view:new S(e)}));break;default:throw new Error("not handled")}e.moveTabToFront(t.tabId),this.updateTabs();const s=e.tabId;for(const[t,e]of this.tabChildren)t===s?e.classList.add("selected"):e.classList.remove("selected")});const e=this.attachShadow({mode:"open"});e.appendChild(z.content.cloneNode(!0)),this.tabs=e.querySelector(".tabs"),console.assert(null!==this.tabs),this.container=e.querySelector(".container"),console.assert(null!==this.container);const s=t.tabs[0];console.assert(0===s.kind),this.switch(s)}update(t){if(t.has(1)&&this.updateTabs(),t.has(2)){const t=this.db;if(t.tabId!==this.curView.tabId){const e=t.tabs.find(e=>e.tabId===t.tabId);console.assert(void 0!==e),this.switch(e)}}this.curView.view.update(t)}updateTabs(){const t=this.db;y(this.tabs);const e=this.tabChildren;this.tabChildren=new Map;for(const s of this.db.tabs){let n=e.get(s.tabId);if(n)this.tabChildren.set(s.tabId,n);else{switch((n=document.createElement("div")).onclick=(()=>this.db.tabId=s.tabId),s.kind){case 0:n.textContent="Galaxy";break;case 1:{const e=t.getPlanetName(s.planetId);n.textContent=e}break;case 2:n.textContent="Search";break;case 3:n.textContent="Player";break;case 4:n.textContent="Nation";break;case 5:n.textContent="Station";break;case 6:n.textContent="People";break;default:throw new Error("not handled")}this.tabChildren.set(s.tabId,n)}this.tabs.appendChild(n)}}switchHelper(t){y(this.container),this.curView=t,this.container.appendChild(t.view)}createGalaxyView(){const t=this.db;return console.assert(t.tabs.length>0&&0===t.tabs[0].kind),{kind:0,tabId:t.tabs[0].tabId,view:new b(this.db)}}}customElements.define("switch-view",R);const A=document.body;console.assert(null!==A);{Object(n.m)();const t=function(){const t={galaxy:n.b.new()};return new f(t)}(),e=[];for(const t in n.e)e.push(t);t.galaxy.add_division_template([e[n.e.Robot],e[n.e.Infantry]],n.a.Push,!1);const s=t.galaxy.get_division_template(0);console.log(s),console.log(n.e[s.squads[0]]),t.galaxy.train_division(0),t.galaxy.train_division(0),t.galaxy.train_division(0),t.galaxy.train_division(0);const r=new R(t),i=document.createElement("input");i.value="Debugger",i.type="button",i.onclick=(()=>{});const o=document.createElement("input");o.value="End Turn",o.type="button",o.onclick=(()=>t.tick());const a=document.createElement("div");a.className="restPanel",document.createElement("div").style.display="flex";document.createElement("div");const c=[],h={update(){for(const t of c)t()}};a.appendChild(i),a.appendChild(o),A.appendChild(r),A.appendChild(a),t.add(h,r),setInterval(()=>t.tick(),p)}},function(t,e,s){"use strict";function*n(t,e){let s=0;for(const n of t)yield e(n,s),++s}function*r(t,e){let s=0;for(const n of t){for(const t of e(n,s))yield t;++s}}function i(t,e,s){let n=s,r=0;for(const s of t)n=e(n,s,r),++r;return n}function*o(t,e){let s=0;for(const n of t){if(s>=e)break;yield n,++s}}function a(t,e){let s=0;for(const n of t){if(!e(n,s))return!1;++s}return!0}function c(t,e){let s=0;for(const n of t){if(e(n,s))return!0;++s}return!1}function h(t,e){let s=0;for(const n of t){if(!1===e(n,s))return;++s}}function*l(t,e){let s=0;for(const n of t)e(n,s)&&(yield n),++s}function*u(t,e){let s,n=!0;for(const r of t)n?(n=!1,s=r):(yield e(s,r),s=r)}function d(t){let e=0;for(const s of t)++e;return e}function f(t){return p(t).take(1).collect()[0]}function p(t){return{collect:()=>Array.from(t),count:()=>d(t),every:e=>a(t,e),filter:e=>p(l(t,e)),first:()=>f(t),flatMap:e=>p(r(t,e)),forEach:e=>h(t,e),map:e=>p(n(t,e)),pin:e=>p(u(t,e)),reduce:(e,s)=>i(t,e,s),some:e=>c(t,e),take:e=>p(o(t,e)),*[Symbol.iterator](){for(const e of t)yield e}}}Object.defineProperty(e,"__esModule",{value:!0}),e.wrapIt=p;e.MyIterable=class{constructor(){this.collect=(()=>Array.from(this)),this.count=(()=>d(this)),this.first=(()=>f(this)),this.flatMap=(t=>p(r(this,t))),this.map=(t=>p(n(this,t))),this.pin=(t=>p(u(this,t))),this.reduce=((t,e)=>i(this,t,e)),this.some=(t=>c(this,t)),this.every=(t=>a(this,t)),this.filter=(t=>p(l(this,t))),this.forEach=(t=>h(this,t)),this.take=(t=>p(o(this,t)))}*[Symbol.iterator](){for(const t of this.iterate())yield t}get isEmpty(){return 0===this.size}}},function(t,e,s){"use strict";s.d(e,"g",function(){return k}),s.d(e,"n",function(){return P}),s.d(e,"o",function(){return O}),s.d(e,"e",function(){return j}),s.d(e,"a",function(){return E}),s.d(e,"c",function(){return T}),s.d(e,"d",function(){return V}),s.d(e,"m",function(){return z}),s.d(e,"f",function(){return A}),s.d(e,"h",function(){return D}),s.d(e,"b",function(){return N}),s.d(e,"k",function(){return L}),s.d(e,"i",function(){return G}),s.d(e,"j",function(){return q}),s.d(e,"l",function(){return B});var n=s(7);let r=null;function i(t){const e=n.y(2*t.length);return(null!==r&&r.buffer===n.pb.buffer||(r=new Uint16Array(n.pb.buffer)),r).set(t,e/2),[e,t.length]}let o=null;function a(){return null!==o&&o.buffer===n.pb.buffer||(o=new Uint32Array(n.pb.buffer)),o}let c=null;function h(){return null===c&&(c=n.x()),c}const l=[],u=[{obj:void 0},{obj:null},{obj:!0},{obj:!1}];function d(t){if(1==(1&t))return l[t>>1];return u[t>>1].obj}let f=u.length;function p(t){if((t>>=1)<4)return;let e=u[t];e.cnt-=1,e.cnt>0||(u[t]=f,f=t)}function g(t){const e=d(t);return p(t),e}let m=new("undefined"==typeof TextEncoder?s(13).TextEncoder:TextEncoder)("utf-8"),w=null;function b(){return null!==w&&w.buffer===n.pb.buffer||(w=new Uint8Array(n.pb.buffer)),w}function y(t){const e=m.encode(t),s=n.y(e.length);return b().set(e,s),[s,e.length]}let v=null;function _(t,e){return(null!==v&&v.buffer===n.pb.buffer||(v=new Int32Array(n.pb.buffer)),v).subarray(t/4,t/4+e)}function M(t){f===u.length&&u.push(u.length+1);const e=f,s=u[e];return f=s,u[e]={obj:t,cnt:1},e<<1}function S(t,e){return b().subarray(t/1,t/1+e)}let I=new("undefined"==typeof TextDecoder?s(13).TextDecoder:TextDecoder)("utf-8");function x(t,e){return I.decode(b().subarray(t,t+e))}const C=console.log;function k(t,e){let s=x(t,e);C(s)}function P(){return n.nb()}function O(){return n.ob()}const j=Object.freeze({Infantry:0,Robot:1,Tank:2,Wagon:3,Colonist:4}),E=Object.freeze({Push:0,Fill:1,Overrun:2,Avoid:3}),T=(Object.freeze({North:0,South:1,East:2,West:3}),Object.freeze({None:0,Civilian:1,Military:2}),Object.freeze({Crop:0,Metal:1,Gem:2,Fuel:3,Concrete:4,Supply:5,Alloy:6,Fiber:7,Chemical:8,Circuit:9,Food:10,Apparel:11,Medicine:12,Computer:13,Accessory:14,Furniture:15,Vehicle:16,Machine:17,Tool:18,Hull:19,Engine:20,Weapon:21,Shield:22,Armor:23,Countermeasure:24,Rifle:25,Uniform:26,Saber:27,Exoskeleton:28})),V=Object.freeze({Freighter:0,Fighter:1,Bomber:2,Trooper:3,Destroyer:4,BombardCraft:5,Battleship:6,Station:7,Fortress:8,Carrier:9,Shipyard:10,Constructor:11});function z(){return n.z()}const R=console.error;function A(t,e){let s=x(t,e);s=s.slice(),n.w(t,1*e),R(s)}const F=Math.random;function D(){return F()}class H{static __wrap(t){const e=Object.create(H.prototype);return e.ptr=t,e}get num_structures(){return n.c(this.ptr)}set num_structures(t){return n.n(this.ptr,t)}free(){const t=this.ptr;this.ptr=0,function(t){n.a(t)}(t)}get_points(){return n.B(this.ptr)}get_dims(){return n.A(this.ptr)}get_roads(){return n.C(this.ptr)}}class N{static __wrap(t){const e=Object.create(N.prototype);return e.ptr=t,e}free(){const t=this.ptr;this.ptr=0,function(t){n.b(t)}(t)}static new(){return N.__wrap(n.lb())}interop_colonize(t,e,s){return n.cb(this.ptr,t,e,s)}justify_war(t,e){return n.jb(this.ptr,t,e)}has_war_goal(t,e){return 0!==n.ab(this.ptr,t,e)}declare_war(t,e,s,r){const[o,a]=i(s),[c,h]=i(r);return n.K(this.ptr,t,e,o,a,c,h)}is_at_war_with(t,e){return 0!==n.ib(this.ptr,t,e)}change_access_right(t,e,s){return n.J(this.ptr,t,e,s)}static access_threshold(t){return n.D(t)}interop_search(t,e){return g(n.fb(this.ptr,t,e))}interop_search_name(t){const[e,s]=y(t);return g(n.gb(this.ptr,e,s))}interop_cal_draw_data(t,e,s,r,i){return g(n.bb(this.ptr,t,e,s,r,i))}get_city_idx(t,e){return n.M(this.ptr,t,e)}static get_city_radius_limit(){return n.N()}cal_city_graph(t,e){return H.__wrap(n.F(this.ptr,t,e))}get_colonized_map(t){const e=h();n.O(e,this.ptr,t);const s=a(),r=s[e/4],i=s[e/4+1],o=_(r,i).slice();return n.w(r,4*i),o}mock_cal_civilian_demands(t){return n.kb(this.ptr,M(t))}get_nation_relation(t){return n.S(this.ptr,t)}interop_search_neighbour_nations(t,e){return g(n.hb(this.ptr,t,e))}has_division(t,e){return 0!==n.Z(this.ptr,t,e)}cal_planet_dim(t){return n.I(this.ptr,t)}get_planet_width(t){return n.Y(this.ptr,t)}get_planet_height(t){return n.U(this.ptr,t)}get_planet_points(t){return n.X(this.ptr,t)}get_planet_path(t,e,s,r,i){const o=h();n.W(o,this.ptr,t,e,s?1:0,r,i);const c=a(),l=c[o/4],u=c[o/4+1],d=S(l,u).slice();return n.w(l,1*u),d}get_planet_edges(t){const e=h();n.T(e,this.ptr,t);const s=a(),r=s[e/4],i=s[e/4+1],o=S(r,i).slice();return n.w(r,1*i),o}get_planet_name(t){const e=h();n.V(e,this.ptr,t);const s=a(),r=s[e/4],i=s[e/4+1],o=x(r,i).slice();return n.w(r,1*i),o}cal_planet_click(t,e,s){const r=h();n.H(r,this.ptr,t,e,s);const i=a(),o=i[r/4],c=i[r/4+1],l=x(o,c).slice();return n.w(o,1*c),l}cal_next_state(){const t=this.ptr;return this.ptr=0,N.__wrap(n.G(t))}add_division_template(t,e,s){return n.E(this.ptr,M(t),e,s?1:0)}get_division_template(t){return g(n.P(this.ptr,t))}train_division(t){return n.mb(this.ptr,t)}interop_move_division(t,e){return n.eb(this.ptr,t,e)}get_divisions_in_training(){return g(n.Q(this.ptr))}get_divisions_undeployed(){return g(n.R(this.ptr))}get_all_division_location(){return g(n.L(this.ptr))}interop_deploy_division(t,e){return n.db(this.ptr,t,e)}}function L(t){p(t)}function G(t,e){return M(JSON.parse(x(t,e)))}function q(t,e){const[s,n]=y(JSON.stringify(d(t)));return a()[e/4]=s,n}function B(t,e){throw new Error(x(t,e))}},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(27)),n(s(29)),n(s(30)),n(s(35)),n(s(9)),n(s(41)),n(s(45)),n(s(46)),n(s(47)),n(s(22)),n(s(48)),n(s(52)),n(s(6))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);class r extends n.MyIterable{constructor(t){super(),this.cmp=t,this.arr=[],this.pop=(()=>{const t=c(this.arr,this.arr.length,this.cmp),e=this.arr.pop();return console.assert(t===e),t}),this.reverseSort=(()=>{const t=this.arr;this.arr=[];for(let e=t.length;e>0;e--)c(t,e,this.cmp);return t}),this.sortInPlace=(()=>{const t=this.reverseSort();let e=0,s=t.length-1;for(;e<s;)a(t,e,s),++e,--s;return t}),this.sort=(()=>{const t=this.sortHelper();return n.wrapIt(t)}),this.add=(t=>{const e=this.arr.length;this.arr.push(t),function(t,e,s){console.assert(e===t.length-1);let n=e;for(;n>0;){const e=i(n);s(t[n],t[e])<0&&a(t,n,e),n=e}}(this.arr,e,this.cmp)}),this.iterate=(()=>this.sortHelper()),this.sortHelper=(()=>(function*(t,e){const s=t;let n=c(s,s.length,e);for(;void 0!==n;)yield s.pop(),n=c(s,s.length,e)})(this.arr.slice(),this.cmp))}static heapify(t,...e){return r.inPlaceWrap(t,e)}static inPlaceWrap(t,e){return r.unsafeWrap(function(t,e){for(let s=Math.floor((t.length-1)/2);s>=0;s--)h(t,s,t.length,e);return t}(e,t),t)}static unsafeWrap(t,e){const s=new r(e);return s.arr=t,s}get size(){return this.arr.length}get top(){return this.isEmpty?void 0:this.arr[0]}}function i(t){return Math.floor((t+1)/2)-1}function o(t){return 2*t+1}function a(t,e,s){const n=t[e];t[e]=t[s],t[s]=n}function c(t,e,s){const n=e-1;if(0===e)return;if(1===e)return t[n];const r=t[0];return a(t,0,n),h(t,0,n,s),r}function h(t,e,s,n){const r=t[e];let i=e;for(;;){let e=o(i);if(e>=s)break;const c=t[e],h=e+1;if(h<s&&n(t[h],c)<0&&(e=h),n(r,t[e])<0)break;a(t,i,e),i=e}}e.MinHeap=r},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.makePair=function(t,e){return[t,e]}},function(t,e,s){"use strict";var n=s.w[t.i];t.exports=n;s(3);n.tb()},function(t,e,s){"use strict";function n(t,e,s,n,r,i){for(;r<=i;){const o=Math.floor((r+i)/2),a=n(s(t[o]),e);if(!Number.isFinite(a))throw new Error("cmp doesn't return finite number");if(a<0)r=o+1;else{if(!(a>0))return[o,r,i];i=o-1}}return[void 0,r,i]}function r(t,e,s,r,i,o){let a=i,c=o;for(;;){const i=a-1,[o,h]=n(t,e,s,r,c,i);if(void 0===o)return a;console.assert(o<=i),a=o,c=h}}function i(t,e,s,r,i,o){let a=i,c=o;for(;;){const i=a+1,[o,,h]=n(t,e,s,r,i,c);if(void 0===o)return a;console.assert(o>=i),a=o,c=h}}function o(t,e,s,i){if(0===t.length)return 0;const[o,a]=n(t,e,s,i,0,t.length-1);return void 0===o?a:r(t,e,s,i,o,a)}function a(t,e,s,r){if(0===t.length)return 0;const[o,a,c]=n(t,e,s,r,0,t.length-1);return void 0===o?a:i(t,e,s,r,o,c)}function c(t,e,s,o){if(0!==t.length){const[a,c,h]=n(t,e,s,o,0,t.length-1);if(void 0===a)return;return[r(t,e,s,o,a,c),i(t,e,s,o,a,h)]}}Object.defineProperty(e,"__esModule",{value:!0}),e.lowerBound=o,e.upperBound=a,e.binarySearch=c,e.binarySearchExist=function(t,e,s,r){if(0===t.length)return;const[i]=n(t,e,s,r,0,t.length-1);return void 0!==i},e.binaryInsert=function(t,e,s,n){if(0===t.length)return[e];const r=o(t,s(e),s,n),i=t.splice(r,0,e);return console.assert(0===i.length),t},e.binaryDelete=function(t,e,s,n){if(0!==t.length){const r=c(t,e,s,n);if(void 0!==r){const[e,s]=r,n=s-e+1;t.splice(e,n)}}return t},e.binarySearchRange=function(t,e,s,n,r){if(0===t.length)return;let i,h;const l=r(e,s);if(l<0)i=e,h=s;else{if(!(l>0))return c(t,e,n,r);i=s,h=e}const u=o(t,i,n,r);let d=a(t,h,n,r);return d===t.length&&t.length>0&&(d=t.length-1),console.assert(u<=d),[u,d]}},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(10)),n(s(33)),n(s(34)),n(s(2))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.combine=function(...t){return n.wrapIt(function*(t){for(const e of t)for(const t of e)yield t}(t))}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(16),r=s(2),i=s(6);function*o(t){const e=n.dfsPreOrder(t,t=>t.next.values()),s=[];let r=0;for(const[t,n]of e){const e=r-n;for(let t=0;t<e;++t)s.pop(),r--;void 0!==t.keyChar?s.push(t.keyChar):console.assert(0===n),++r,void 0!==t.val&&(yield i.makePair(s.slice(),t.val))}}e.Trie=class extends r.MyIterable{constructor(...t){super(),this.root={next:new Map},this.trieSize=0,this.get=(t=>{const e=this.traverse(t);return void 0===e?void 0:e.val}),this.has=(t=>void 0!==this.get(t)),this.delete=(t=>{const e=[],s=this.traverse(t,(t,s)=>e.push([t,s]));if(void 0===s||void 0===s.val)return!1;--this.trieSize;let n=s;for(let t=e.length-1;t>=0&&0===n.next.size;t--){const[s,r]=e[t];console.assert(r.next.size>0),r.next.delete(s),n=r}return!0}),this.set=((t,e)=>{let s=this.root;return t.forEach(t=>{if(void 0===t)throw new Error("undefined not allowed as part of the key");let e=s.next.get(t);void 0===e&&(e={next:new Map},s.next.set(t,e)),e.keyChar=t,s=e}),s.val=e,++this.trieSize,this}),this.getOrSet=((t,e)=>{let s=this.root;if(t.some(t=>void 0===t))throw new Error("undefined is not allowed to be part of the key");for(const e of t){let t=s.next.get(e);void 0===t&&(t={next:new Map},s.next.set(e,t)),t.keyChar=e,s=t}return void 0===s.val&&(s.val=e(),++this.trieSize),s.val}),this.keys=(()=>r.wrapIt(o(this.root)).map(([t])=>t)),this.values=(()=>r.wrapIt(o(this.root)).map(([,t])=>t)),this.getFanout=(t=>{const e=this.traverse(t);return e?e.next.size:0}),this.iterate=(()=>o(this.root)),this.traverse=((t,e=(()=>{}))=>{let s=this.root;for(const n of t){const t=s.next.get(n);if(void 0===t)return;e(n,s),s=t}return s});for(const[e,s]of t)this.set(e,s)}get size(){return this.trieSize}get isEmpty(){return 0===this.size}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(10),r=s(2),i=s(18),o=s(20);e.intersect=((...t)=>o.wrapSet(function(...t){switch(t.length){case 0:return new Set;case 1:return new Set(t[0]);case 2:let e,s;return t[0].size>t[1].size?(e=t[1],s=t[0]):(e=t[0],s=t[1]),new Set(r.wrapIt(e).filter(t=>s.has(t)));default:return new Set(r.wrapIt(i.groupBy(n.combine(...t),t=>t)).filter(([,e])=>t.length===e.length).map(([t])=>t))}}(...t)))},,function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(5),r=s(8);e.mergeK=function(t,e,...s){const i=s.filter(t=>t.length>0);switch(i.length){case 0:return[];case 1:return i[0].slice();case 2:const s=i[0],n=i[1];return 1===s.length?r.binaryInsert(n.slice(),s[0],t,e):1===n.length?r.binaryInsert(s.slice(),n[0],t,e):Array.from(function(t,e,s,n){console.assert(t.length>0&&e.length>0);let r=0,i=0;const o=[];for(;;){const a=t[r],c=e[i];if(n(s(a),s(c))<0?(o.push(a),++r):(o.push(c),++i),r===t.length)return o.concat(e.slice(i));if(i===e.length)return o.concat(t.slice(r))}}(s,n,t,e))}const o=n.MinHeap.inPlaceWrap(([s,n],[r,i])=>e(t(s[n]),t(r[i])),i.map((t,e)=>[i[e],0])),a=[];for(;;){const[t,e]=o.pop();a.push(t[e]);const s=e+1;if(0===o.size)return s<t.length?a.concat(t.slice(s)):a;s<t.length&&o.add([t,s])}}},function(t,e,s){"use strict";function n(t,e,s){const[n]=r(t,e,s);return n}function r(t,e,s){let n=0;for(;;){if(n===e.length)return n===s.length?[0,void 0]:[-1,n];if(n===s.length)return[1,n];const r=t(e[n],s[n]);if(0!==r)return[r,n];++n}}Object.defineProperty(e,"__esModule",{value:!0}),e.cmpList=n,e.listEqual=function(t,e,s){return 0===n(t,e,s)},e.listDiff=function(t,e,s){const[,n]=r(t,e,s);return n}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);function*r(t,e){const s=[[t,0]],n=new Set;for(;s.length>0;){const[t,r]=s.pop();if(!n.has(t)){yield[t,r],n.add(t);const i=r+1;for(const n of e(t))s.push([n,i])}}}e.dfsPreOrder=function(t,e){return n.wrapIt(r(t,e))},e.dfsPreOrderHelper=r},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);class r extends n.MyIterable{constructor(){super(...arguments),this.toId=new Map,this.parents=new Map,this.id=0,this.union=((...t)=>{if(t.length>0){const e=t[0];for(let s=1;s<t.length;++s){const n=t[s];this.union2(e,n)}}return this}),this.isSameSet=((t,e)=>{if(console.assert(void 0!==t),console.assert(void 0!==e),t===e)return!0;const s=this.find(t);if(void 0===s)return!1;const n=this.find(e);if(void 0===n)return!1;const[r]=s,[i]=n;return r===i}),this.tear=((...t)=>{for(const e of t)this.toId.delete(e)&&(this.memoizedSets=void 0,this.add(e));return this.recycle(),this}),this.delete=(t=>{const e=this.toId.delete(t);return e&&(this.memoizedSets=void 0),this.recycle(),e}),this.clone=(()=>{const t=new r;return t.toId=new Map(this.toId),t.parents=new Map(this.parents),t.id=this.id,t}),this.deleteSets=((...t)=>{let e=!1;for(const s of t)for(const t of this.get(s)){const s=this.toId.get(t);this.parents.delete(s),this.toId.delete(t),e=!0}e&&(this.memoizedSets=void 0),this.recycle()}),this.has=(t=>void 0!==this.find(t)),this.iterate=(()=>(void 0===this.memoizedSets&&(this.memoizedSets=this.aggregate()),this.memoizedSets.values())),this.aggregate=(()=>{const t=new Map;for(const[e,s]of this.toId){const[n]=this.findInner(s),r=t.get(n);void 0===r?t.set(n,new Set([e])):r.add(e)}return t}),this.findMut=(t=>{const e=this.toId.get(t);return void 0===e?this.add(t):this.findInner(e)}),this.union2=((t,e)=>{console.assert(void 0!==t),console.assert(void 0!==e),this.memoizedSets=void 0;const[s,n]=this.findMut(t),[r,i]=this.findMut(e);return s===r?this:(n<i?this.parents.set(s,[r,n]):n>i?this.parents.set(r,[s,i]):this.parents.set(s,[r,i+1]),this.recycle(),this)}),this.recycle=(()=>{if(this.garbageRatio<2)return;this.memoizedSets=void 0;const t=new r;for(const e of this){const s=e.values().next().value;console.assert(void 0!==s);for(const n of e)t.union(s,n)}this.toId=t.toId,this.parents=t.parents,this.id=t.id}),this.add=(t=>{console.assert(void 0===this.toId.get(t)),this.memoizedSets=void 0;const e=++this.id;this.toId.set(t,e);const s=[e,0];return this.parents.set(e,s),s}),this.find=(t=>{const e=this.toId.get(t);if(void 0!==e)return this.findInner(e)}),this.findInner=(t=>{const e=[];let s=t;for(;;){const[t,n]=this.parents.get(s);if(s===t){for(const s of e)this.parents.set(s,[t,n]);return[t,n]}e.push(s),s=t}})}get size(){return this.toId.size}get(t){return n.wrapIt(this.getHelper(t))}*getHelper(t){const e=this.find(t);if(void 0===e)return;const[s]=e;void 0===this.memoizedSets&&(this.memoizedSets=this.aggregate());const n=this.memoizedSets.get(s);if(void 0!==n)for(const t of n)yield t}get structureSize(){return this.parents.size}get garbageRatio(){return 0===this.size?0:this.structureSize/this.size}}e.UnionFind=r},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.groupBy=function(t,e){const s=new Map;for(const n of t){const t=e(n);let r=s.get(t);void 0===r&&(r=[],s.set(t,r)),r.push(n)}return s}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(10),r=s(2),i=s(12),o=s(6);function a(t,e,s){return new Map(r.wrapIt(t).map(t=>{const n=s(...r.wrapIt(e).map(e=>e.get(t)).filter(t=>void 0!==t));return o.makePair(t,n)}))}e.outerJoin=function(t,...e){return a(new Set(n.combine(...e.map(t=>t.keys()))),e,t)},e.leftJoin=function(t,e,...s){return a(e.keys(),[e,...s],t)},e.innerJoin=function(t,...e){return a(i.intersect(...e.map(t=>new Set(t.keys()))),e,t)}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(9),r=s(21),i=s(12);function o(t){return{add:e=>o(t.add(e)),collect:()=>Array.from(t),count:()=>n.wrapIt(t).count(),delete:e=>t.delete(e),difference:(...e)=>o(r.difference(t,...e)),every:e=>n.wrapIt(t).every(e),filter:e=>a(n.wrapIt(t).filter(e)),first:()=>n.wrapIt(t).first(),flatMap:e=>n.wrapIt(t).flatMap(e),forEach:e=>n.wrapIt(t).forEach(e),has:e=>t.has(e),intersect:(...e)=>i.intersect(t,...e),map:e=>a(n.wrapIt(t).map(e)),pin:e=>a(n.wrapIt(t).pin(e)),reduce:(e,s)=>n.wrapIt(t).reduce(e,s),get size(){return t.size},some:e=>n.wrapIt(t).some(e),take:e=>a(n.wrapIt(t).take(e)),*[Symbol.iterator](){for(const e of t)yield e}}}function a(t){return o(new Set(t))}e.unionMut=function(t,...e){for(const s of e)t.add(s);return t},e.wrapSet=o,e.makeSet=a},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.difference=function(t,...e){return e.reduce((t,e)=>{const s=new Set(e),n=new Set;for(const e of t)s.has(e)||n.add(e);return n},new Set(t))}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(19);function r(...t){let e=0;for(const s of t)e+=s;return e}e.negate=function(t){const e=new Map;for(const[s,n]of t)e.set(s,-n);return e},e.sum=r,e.average=function(t,...e){return(t+r(...e))/(e.length+1)},e.sumBy=function(t,e){let s=0;for(const n of e)s+=t(n);return s},e.sumMaps=function(...t){return n.outerJoin((...t)=>r(...t),...t)}},,,,,function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(5)),n(s(28))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(8),r=s(14),i=s(2);class o extends i.MyIterable{constructor(t,e){super(),this.toKey=t,this.cmp=e,this.data=[],this.pendList=[],this.add=((...t)=>(this.pendList.push(...t),this)),this.has=(t=>void 0!==this.search(t)),this.clone=(()=>o.lightWrap(this.getData().slice(),this.toKey,this.cmp)),this.slice=((t,e)=>this.getData().slice(t,e)),this.right=(t=>o.lightWrap(function(t,e,s,r){if(0===t.length)return[];const i=n.lowerBound(t,e,s,r);return t.slice(i)}(this.getData(),t,this.toKey,this.cmp),this.toKey,this.cmp)),this.left=(t=>o.lightWrap(function(t,e,s,r){if(0===t.length)return[];const i=n.upperBound(t,e,s,r);return t.slice(0,i+1)}(this.getData(),t,this.toKey,this.cmp),this.toKey,this.cmp)),this.get=((t,e)=>{const s=void 0===e?this.search(t):this.range(t,e);if(void 0===s)return[];const[n,r]=s;return this.slice(n,r+1)}),this.range=((t,e)=>{if(!this.isEmpty)return n.binarySearchRange(this.getData(),t,e,this.toKey,this.cmp)}),this.countRange=((t,e)=>{if(this.isEmpty)return 0;const s=void 0===e?this.search(t):this.range(t,e);if(void 0===s)return 0;const[n,r]=s;return r-n+1}),this.getAt=(t=>this.getData()[t]),this.deleteAt=((t,e=1)=>(console.assert(e>=0),e>=1&&t>=0&&t<this.size&&this.getData().splice(t,e),this)),this.delete=(t=>{if(this.isEmpty)return this;const e=this.getData(),s=n.binarySearch(e,t,this.toKey,this.cmp);if(void 0===s)return this;const[r,i]=s,o=i-r+1;return console.assert(o>=1),e.splice(r,o),this}),this.search=(t=>n.binarySearch(this.getData(),t,this.toKey,this.cmp)),this.iterate=(()=>this.getData()),this.getData=(()=>{if(this.pendList.length>0){const t=o.sort(this.pendList,this.toKey,this.cmp);this.data=r.mergeK(this.toKey,this.cmp,t,this.data),this.pendList=[]}return this.data})}static wrap(t,e,s){const n=o.sort(Array.from(t),e,s);return o.lightWrap(n,e,s)}static lightWrap(t,e,s){const n=new o(e,s);return n.data=t,n}static sort(t,e,s){return t.sort((t,n)=>s(e(t),e(n)))}get size(){return this.data.length+this.pendList.length}get isEmpty(){return 0===this.size}}e.SortedList=o},function(t,e,s){"use strict";function n(t,e){let s,n;return t>e?(s=e,n=t):(s=t,n=e),[s,n]}Object.defineProperty(e,"__esModule",{value:!0}),e.clamp=function(t,e,s){const[r,i]=n(e,s);return Math.min(i,Math.max(r,t))},e.position=function(t,e,s){const[r,i]=n(e,s),o=t-r,a=i-r;return o<0?0:0===a?1:Math.min(1,o/a)}},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(8)),n(s(15)),n(s(31)),n(s(14)),n(s(32))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.isSorted=function(t,e){return n.wrapIt(t).pin((t,s)=>e(t,s)<=0).every(t=>t)}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(9);e.uniq=function(t,e){return n.wrapIt(function*(t,e){let s,n=!0;for(const r of t){if(n){s=r,n=!1;continue}const t=e(r,s);if(t>0)yield s,s=r;else if(t<0)throw new Error("input iterable is not sorted in ascending order (based on cmp)")}void 0!==s&&(yield s)}(t,e))}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.genBy=function(t){return n.wrapIt(function*(){for(let e=0;;++e)yield t(e)}())}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.repeat=function(t){return n.wrapIt(function*(t){for(;;)yield t}(t))}},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(36)),n(s(37)),n(s(16)),n(s(38)),n(s(39)),n(s(40))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(5),r=s(6);function i(t,e,s,i,o=(()=>0),...a){if(!t.has(i))throw new Error("source is not a node in the graph");if(a.some(e=>!t.has(e)))throw new Error("destination is not a node in the graph");const c=new Set(a);if(c.has(i))return void console.assert(!1,"source and destination are the same, what are you searching for?");const h=0===a.length,l=new Map([[i,0]]),u=new Map,d=n.MinHeap.heapify(([,t],[,e])=>t-e,r.makePair(i,0));for(;!d.isEmpty;){const[t]=d.pop();if(c.has(t)&&(c.delete(t),0===c.size))return{distance:l,parent:u};for(const n of e(t)){const e=l.get(n),r=l.get(t);console.assert(void 0!==r);const i=s(t,n);if(console.assert(void 0!==i),i<=0)throw new Error("weight must be positive (for progress to happen)");const c=r+i;if(void 0!==e&&c>=e)continue;l.set(n,c);const f=h?0:Math.min(...a.map(t=>o(t,n)));if(f<0)throw new Error("heuristic estimate should be non-negative");const p=c+f;d.add([n,p]),u.set(n,t)}}return h?{distance:l,parent:u}:void 0}e.aStar=i,e.aStarAdjList=function(t,e,s,n=(()=>0),...r){return i(new Set(t.keys()),e=>t.get(e),e,s,n,...r)},e.extractPath=function(t,e,s){let n=s;const r=[];if(void 0!==t.get(n))for(;;){if(r.push(n),n===e)return r;n=t.get(n)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.bfsPreOrder=function(t,e,s=1/0){return n.wrapIt(function*(t,e,s){const n=[[t,0]],r=new Set;for(;n.length>0;){const[t,i]=n.shift();yield[t,i],r.add(t);const o=i+1;if(o<=s)for(const s of e(t))r.has(s)||(r.add(s),n.push([s,o]))}}(t,e,s))}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.FloydWarshall=class{constructor(t,e){this.vertices=[...t.keys()],this.verticesIdx=new Map(Array.from(this.vertices).map((t,e)=>[t,e]));const s=t.size,n=new Array(s),r=this.nextMap=new Array(s);for(let t=0;t<s;++t)n[t]=new Array(s).fill(1/0),r[t]=new Array(s),n[t][t]=0;for(const[s,i]of t)for(const t of i){const i=this.verticesIdx.get(s),o=this.verticesIdx.get(t);n[i][o]=e(s,t),r[i][o]=o}for(let t=0;t<s;t++)for(let e=0;e<s;++e)for(let i=0;i<s;i++){const s=n[e][t]+n[t][i];n[e][i]>s&&(n[e][i]=s,r[e][i]=r[e][t])}}next(t,e){const s=this.verticesIdx.get(e),n=this.verticesIdx.get(t),r=this.nextMap[n][s];if(void 0!==r)return this.vertices[r]}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(17);e.kruskalMST=function(t,e,s){const r=new n.UnionFind,i=Array.from(t).reduce((t,s)=>{for(const n of e(s))t.push([s,n]);return t},new Array).sort(([t,e],[n,r])=>s(t,e)-s(n,r)),o=new Map(Array.from(t).map(t=>[t,[]]));for(const[t,e]of i)r.isSameSet(t,e)||(o.get(t).push(e),o.get(e).push(t),r.union(t,e));return o}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(5);e.stableMarriage=function(t,e){const s=function(t,e){const s=new Map;for(const[r,i]of t){const t=n.MinHeap.inPlaceWrap((t,e)=>i(e)-i(t),Array.from(e.keys()).filter(t=>void 0!==i(t)));s.set(r,t)}return s}(t,e),r=new Map,i=Array.from(t.keys());for(;i.length>0;){const t=i.pop(),n=s.get(t);for(;!n.isEmpty;){const s=n.pop(),o=e.get(s),a=o(t);if(void 0===a)continue;const c=r.get(s);if(void 0===c){r.set(s,t);break}if(a>o(c)){r.set(s,t),i.push(c);break}}}return r}},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(42)),n(s(43)),n(s(18)),n(s(19)),n(s(44)),n(s(11))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.BiMap=class extends n.MyIterable{constructor(...t){super(),this.iterate=(()=>this.leftMap.entries()),this.leftMap=new Map(t),this.rightMap=new Map(t.map(([t,e])=>[e,t]))}get size(){return console.assert(this.leftMap.size===this.rightMap.size),this.leftMap.size}set(t,e){return this.leftMap.set(t,e),this.rightMap.set(e,t),this}delete(t){const e=this.leftMap.get(t);return void 0!==e&&this._delete(t,e)}deleteRight(t){const e=this.rightMap.get(t);return void 0!==e&&this._delete(e,t)}get(t){return this.leftMap.get(t)}getLeft(t){return this.rightMap.get(t)}has(t){return this.leftMap.has(t)}hasRight(t){return this.rightMap.has(t)}keys(){return this.leftMap.keys()}values(){return this.leftMap.values()}_delete(t,e){const s=this.leftMap.delete(t),n=this.rightMap.delete(e);return console.assert(s),console.assert(n),!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(11);function r(t){return t.replace(/\s/g,"").toLowerCase()}function*i(t){const e=t.length;for(let s=0;s<e;s++)for(let n=1;n<=e-s;n++)yield t.substr(s,n)}e.Dictionary=class{constructor(){this.dict=new n.Trie}set(t,e,s){const n=r(t);for(const t of i(n))this.dict.getOrSet(Array.from(t),()=>new Map).set(e,s);return this}batchSet(t,e){const s=r(t);for(const t of i(s)){const s=this.dict.getOrSet(Array.from(t),()=>new Map);for(const[t,n]of e)s.set(t,n)}return this}search(t){const e=r(t);return(this.dict.get(Array.from(e))||new Map).entries()}delete(t,e){const s=r(t);let n=!1;for(const t of i(s)){const s=this.dict.get(Array.from(t));if(void 0!==s){const t=s.delete(e);console.assert(n&&t),n=!0}}return n}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(15),r=s(2),i=s(11);class o extends r.MyIterable{constructor(t,...e){super(),this.cmp=t,this.get=(t=>this.data.get(o.sortKey(this.cmp,t))),this.has=(t=>this.data.has(o.sortKey(this.cmp,t))),this.delete=(t=>this.data.delete(o.sortKey(this.cmp,t))),this.set=((t,e)=>this.data.set(o.sortKey(this.cmp,t),e)),this.getOrSet=((t,e)=>this.data.getOrSet(o.sortKey(this.cmp,t),e)),this.keys=(()=>r.wrapIt(this.iterate()).map(([t])=>t)),this.values=(()=>r.wrapIt(this.iterate()).map(([,t])=>t)),this.makeEmpty=(()=>new o(this.cmp)),this.iterate=(()=>o.iterateHelper(this.cmp,this.data)),this.data=new i.Trie(...e.map(([e,s])=>[o.sortKey(t,e),s]))}static*iterateHelper(t,e){const s=Array.from(e).sort(([e],[s])=>n.cmpList(t,e,s));for(const t of s)yield t}get size(){return this.data.size}get isEmpty(){return 0===this.size}}o.sortKey=((t,e)=>e.slice().sort(t)),e.SortedTrie=o},function(t,e,s){"use strict";function n([t,e],[s,n]){return[t-s,e-n]}function r([t,e]){return Math.sqrt(t*t+e*e)}function i(t,e){return r(n(t,e))}function o([t,e],s){return[s*t,s*e]}function a([t,e],[s,n]){return t*n-s*e}function c([t,e],[s,n],[r,i]){const o=Math.max(s,r),a=Math.min(s,r),c=Math.max(n,i),h=Math.min(n,i);return t<=o&&t>=a&&e<=c&&e>=h}var h;function l(t,e,s,r){const o=n(t,s),c=n(e,s),l=i(t,e),u=l*l,d=r*r,f=a(o,c),p=d*u-f*f;return p<0?h.None:p>0?h.Intersection:h.Tangent}Object.defineProperty(e,"__esModule",{value:!0}),e.equal=function([t,e],[s,n]){return t===s&&e===n},e.compare=function([t,e],[s,n]){return t<s?-1:t>s?1:e-n},e.subtract=n,e.add=function([t,e],[s,n]){return[t+s,e+n]},e.norm=r,e.distance=i,e.scalarMult=o,e.manhattanDistance=function(t,e){const[s,r]=n(t,e);return Math.abs(s)+Math.abs(r)},e.project=function(t,e=1){const s=r(t);return console.assert(0!==s,"caller make sure the given vector is not the origin"),o(t,e/s)},e.determinant=a,e.dot=function([t,e],[s,n]){return t*s+e+n},e.isPointInRect=c,function(t){t[t.None=0]="None",t[t.Tangent=1]="Tangent",t[t.Intersection=2]="Intersection"}(h=e.IntersectionKind||(e.IntersectionKind={})),e.testLineCircleIntersect=l,e.testLineSegmentCircleIntersect=function(t,e,s,n){return c(s,t,e)?l(t,e,s,n):h.None}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.memo=function(t){const e=new Map;return s=>{if(!e.has(s)){const n=t(s);e.set(s,n)}return e.get(s)}},e.memoBy=function(t,e){const s=new Map;return n=>{if(!s.has(n)){const r=e(n);for(const[e,n]of t(r)){if(s.has(e))throw new Error("genRange keys overlap (all keys from keyBy must be mapped to disjoint sets");s.set(e,n)}if(!s.has(n))throw new Error("genRange doesn't cover the target")}return s.get(n)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getAndSum=function(t,e,s){const n=(t.get(e)||0)+s;return t.set(e,n),n},e.updateMap=function(t,e,s){const n=s(t.get(e));return t.set(e,n),n}},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(49)),n(s(50)),n(s(51))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.diamondSquare=function(t,e,s){console.assert(Number.isInteger(Math.log2(e-1)),"nside must be of the form (2^n)+1");const n=new Float32Array(e*e),r=e-1,i=([t,s])=>t>=0&&t<e&&s>=0&&s<e,o=([t,s])=>s*e+t,a=t=>n[o(t)],c=(t,e)=>{const s=o(t);console.assert(e>0),console.assert(0===n[s]),n[s]=e},h=(e,s,n)=>{const r=s.filter(i).map(a),o=r.reduce((t,e)=>t+e,0)/r.length+t()*n;console.assert(Number.isFinite(o)),c(e,o)},l=(t,e)=>{const s=t/2;for(let n=s;n<=r;n+=t)for(let i=s;i<=r;i+=t)h([i,n],[[i-s,n-s],[i+s,n-s],[i-s,n+s],[i+s,n+s]],e)},u=(t,e)=>{const s=t/2;let n=!0;for(let i=0;i<=r;i+=s){const o=n?s:0;n=!n;for(let n=o;n<=r;n+=t)h([n,i],[[n,i-s],[n,i+s],[n-s,i],[n+s,i]],e)}};{c([0,0],t()),c([0,e-1],t()),c([e-1,0],t()),c([e-1,e-1],t());let n=.1;for(let t=r;t>1;n=(t/=2)/e*s)l(t,n),u(t,n)}const d=Math.max(...n),f=Math.min(...n),p=d-f;console.assert(p>0);const g=n.map(t=>(t-f)/p);return console.assert(g.every(t=>t>=0&&t<=1)),g}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(22);e.randomGen=((t,e)=>{if(n.sum(...t.values())>1)throw new Error("probability needs to be positive and less than 1");const s=[],r=[];for(const[e,n]of t){if(n<=0)throw new Error("probability needs to be positive and less than 1");s.push(e),r.push(n)}const i=void 0===e?Math.random:e;return()=>{const t=i();let e=0;for(let n=0;n<r.length;++n)if(t<(e+=r[n]))return s[n]}}),e.randomGenStrict=((t,s,n)=>{if(s.has(t))throw new Error("remain should ∉ probs");const r=e.randomGen(s,n);return()=>{const e=r();return void 0===e?t:e}})},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.shuffleSlice=function(t){return n.wrapIt(function*(t){const e=Array.from(t);if(0!==e.length)for(;;){const t=e.length-1,s=Math.floor(Math.random()*t);if(yield e[s],s===t)return;e[s]=e.pop()}}(t))}},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(53)),n(s(21)),n(s(12)),n(s(17)),n(s(20))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.BiSet=class extends n.MyIterable{constructor(...t){super(),this.leftMap=new Map,this.rightMap=new Map,this.iterate=(()=>this.leftMap.entries());for(const[e,s]of t)this.add(e,s)}get size(){return this.leftMap.size}add(t,e){this.leftMap.set(t,e),this.rightMap.set(e,t)}deleteLeft(t){const e=this.leftMap.get(t);return void 0!==e&&this.deleteHelper(t,e)}deleteRight(t){const e=this.rightMap.get(t);return void 0!==e&&this.deleteHelper(e,t)}getRight(t){return this.leftMap.get(t)}getLeft(t){return this.rightMap.get(t)}hasLeft(t){return this.leftMap.has(t)}hasRight(t){return this.rightMap.has(t)}lefts(){return n.wrapIt(this.leftMap.keys())}rights(){return n.wrapIt(this.rightMap.keys())}deleteHelper(t,e){const s=this.leftMap.delete(t),n=this.rightMap.delete(e);return console.assert(s),console.assert(n),!0}}}]]);
//# sourceMappingURL=1.bundle.js.map