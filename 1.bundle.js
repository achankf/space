(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[,function(t,e,s){"use strict";s.r(e);var n,o,r=s(3);!function(t){t[t.Corporate=0]="Corporate",t[t.Colonial=1]="Colonial",t[t.National=2]="National"}(n||(n={})),function(t){t[t.CEO=0]="CEO",t[t.HeadOfColony=1]="HeadOfColony",t[t.HeadOfPlanet=2]="HeadOfPlanet",t[t.HeadOfState=3]="HeadOfState",t[t.FieldMarshall=4]="FieldMarshall",t[t.General=5]="General",t[t.Worker=6]="Worker"}(o||(o={}));const i=20;function a(t,e){const s=t.colonyGovs.get(e);return console.assert(void 0!==s),s}function c(t,e){return h(0,0,t,e)}function l(t,e,s,n){const o=t.locs.get(e);console.assert(void 0!==o);const[r,i]=o;return h(r,i,s,n)}function h(t,e,s,n){const o=t+s*Math.cos(n),i=e+s*Math.sin(n);return Object(r.makePair)(o,i)}var u;!function(t){t[t.Crop=0]="Crop",t[t.Metal=1]="Metal",t[t.Gem=2]="Gem",t[t.Fuel=3]="Fuel",t[t.Fiber=4]="Fiber",t[t.Chemical=5]="Chemical",t[t.Circuit=6]="Circuit",t[t.Computer=7]="Computer",t[t.Food=8]="Food",t[t.Drink=9]="Drink",t[t.Apparel=10]="Apparel",t[t.Medicine=11]="Medicine",t[t.Accessory=12]="Accessory",t[t.Furniture=13]="Furniture",t[t.Gadget=14]="Gadget",t[t.Vehicle=15]="Vehicle",t[t.Machine=16]="Machine",t[t.Tool=17]="Tool"}(u||(u={}));const d=Object.keys(u).filter(t=>"number"==typeof u[t]),f=d.map(t=>Number(u[t])).sort((t,e)=>t-e);d.length;function p(){return f.slice()}const m=new Map([[u.Crop,[]],[u.Metal,[]],[u.Gem,[]],[u.Fuel,[]],[u.Food,[new Set([u.Crop])]],[u.Drink,[new Set([u.Crop])]],[u.Apparel,[new Set([u.Fiber])]],[u.Medicine,[new Set([u.Chemical])]],[u.Fiber,[new Set([u.Crop])]],[u.Chemical,[new Set([u.Crop,u.Metal,u.Gem,u.Fuel])]],[u.Circuit,[new Set([u.Metal])]],[u.Computer,[new Set([u.Circuit])]],[u.Accessory,[new Set([u.Gem])]],[u.Furniture,[new Set([u.Fiber])]],[u.Gadget,[new Set([u.Computer])]],[u.Vehicle,[new Set([u.Metal])]],[u.Machine,[new Set([u.Metal]),new Set([u.Computer])]],[u.Tool,[new Set([u.Metal])]]]);function w(t,e){const s=t.planets.get(e)||t.stars.get(e);return console.assert(void 0!==s),s}console.assert(p().every(t=>void 0!==function(t){return m.get(t)}(t)));const g=2*Math.PI,y=.001;function b(t,e,s){const n=t.orbitAngles.get(e);console.assert(void 0!==n);const o=s.orbitDist,r=(n+1*y/Math.pow(o,2))%g;return console.assert(Number.isFinite(r)),r}function v(t,e){return(Math.floor(t)<<16)+Math.floor(e)}function M(t){for(const[e,s]of t.stars){const n=b(t,e,s);t.orbitAngles.set(e,n);const o=c(s.orbitDist,n);t.locs.set(e,o)}for(const[e,s]of t.planets){const n=b(t,e,s);t.orbitAngles.set(e,n);const o=l(t,s.center,s.orbitDist,n);t.locs.set(e,o)}return t.cachedLocIdx.clear(),t.cachedLocIdx=function(t){const e=new Map;for(const[s,[n,o]]of t.locs){const t=v(n/i,o/i);let r=e.get(t);void 0===r&&(r=new Set,e.set(t,r)),r.add(s)}return e}(t),t}function S(t){const e=t.pop,s=[];return s[u.Food]=e,s[u.Drink]=e,s[u.Apparel]=e,s[u.Medicine]=e,s}function I(t,e){t.storages.get(e);return p().map(()=>1),p().map(()=>1)}function k(t){let e=t;return e=function(t){return t}(e=function(t){return t}(e=function(t){for(const e of t.colonyGovs.keys()){const s=t.storages.get(e)||[],n=a(t,e),o=Array.from(n.zones),r=o.map(e=>{const s=t.zones.get(e);return console.assert(void 0!==s),[e,S(s)]}),i=I(t,e),c=new Map(o.map(t=>[t,[]]));t:for(const n of p()){let o=s[n]||0;console.assert(o>=0);const a=i[n];console.assert(a>0);for(const[s,i]of r){if(console.assert(o>=0),0===o)continue t;const r=i[n]||0;if(0===r)continue;console.assert(r>=0);const l=t.account.get(s)||0,h=Math.floor(l/a),u=Math.min(h,r,o);if(0===u)continue;const d=c.get(s);console.assert(void 0!==d),d[n]=u;const f=a*u;t.account.set(s,l-f);const p=t.account.get(e)||0;t.account.set(e,p+f),o-=u}}for(const[t,e]of c);}return t}(e)))}const C=2*Math.PI;function x(){let t=0;function e(e,s,n){const o=Symbol();return e.stars.set(o,{massKind:0,name:`Star ${t}`,orbitDist:s,radius:1}),++t,e.orbitAngles.set(o,n),e.locs.set(o,c(s,n)),o}let s=1;function o(t,e,n){const o=t.stars.get(e);console.assert(void 0!==o);const r=[];Array.from({length:900},()=>({eduLvl:0,energyLvl:0,happyLvl:0,healthLvl:0,housing:0,industryPts:new Map,infrLvl:0,pop:1e3*Math.random(),safetyLvl:0})).forEach((e,s)=>{const n=Symbol();t.zones.set(n,e),r[s]=n});const i=Symbol();t.planets.set(i,{center:e,donationBudget:new Map,height:30,industryDistribution:new Map,industryPts:new Map,marketingBudget:new Map,massKind:1,name:`${o.name}-${function t(e){switch(e){case 1:return"I";case 2:return"II";case 3:return"III";case 4:return t(1)+t(5);case 5:return"V";case 6:return t(5)+t(1);case 7:return t(5)+t(2);case 8:return t(5)+t(3);case 9:return t(1)+t(10);case 10:return"X";case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:{const s=20-e;return t(10)+t(s)}default:throw new Error("not handled")}}(s)}`,orbitDist:n,radius:.3,width:30,zones:r}),++s;const a=Math.random()*C;return t.orbitAngles.set(i,a),t.locs.set(i,l(t,e,n,a)),i}const i={account:new Map,cachedLocIdx:new Map,colonyGovs:new Map,corps:new Map,locs:new Map,nations:new Map,orbitAngles:new Map,people:new Map,planetColonyMap:new r.BiMap,planets:new Map,stars:new Map,stock:new Map,storages:new Map,tick:0,zones:new Map};for(let t=0;t<20;t++){const n=Math.random()*C,r=200*t+100,a=Math.ceil(Math.pow(Math.max(t,Math.random()*(t+4)),1.3)+1),c=C/a;let l=n;for(let t=0;t<a;t++){const t=e(i,r,l);l+=c;const n=Math.floor(8*Math.random()+2);let a=2*Math.random()+2;s=1;for(let e=0;e<n;e++)a+=2*Math.random()+2,o(i,t,a)}}let a=1;const h=.2*i.planets.size;return Object(r.shuffleSlice)(i.planets).take(h).forEach(([t,e])=>{const s=Symbol(),o=Symbol();i.nations.set(s,{colGov:new Set,kind:n.National,name:`Nation ${a++}`,policies:new Set,taxRate:0}),i.colonyGovs.set(o,{allegiance:s,kind:n.Colonial,locatedSrc:t,policies:new Set,taxRate:0,zones:new Set}),i.planetColonyMap.set(t,o)}),i}function O(t,e,s){switch(s.job){case o.CEO:case o.FieldMarshall:case o.General:case o.HeadOfColony:case o.HeadOfPlanet:case o.HeadOfState:case o.Worker:break;default:throw new Error("not handled")}}const P=40,_=1,E=10,j=40,z=2*Math.PI,T=[0,1,2,3],V=[{kind:0,tabId:Symbol()},{kind:3,tabId:Symbol()},{kind:4,tabId:Symbol()},{kind:5,tabId:Symbol()},{kind:6,tabId:Symbol()},{kind:2,tabId:Symbol()}];var A=s(6),H=s(54);class D extends HTMLCanvasElement{constructor(t){super(),this.db=t,this.ctx=this.getContext("2d"),this.cachedGrid=document.createElement("canvas"),this.shouldUpdateGrid=!0,this.shouldRedrawView=!0,this.draw=(()=>{this.resizeCanvas(),this.updatePanAnimation&&(this.updatePanAnimation(),this.shouldUpdateGrid=!0,this.shouldRedrawView=!0),this.shouldUpdateGrid&&this.updateCachedGrid();const t=this.ctx;this.shouldRedrawView&&0!==this.width&&0!==this.height&&(t.clearRect(0,0,this.width,this.height),t.drawImage(this.cachedGrid,0,0),this.drawObjects()),this.shouldRedrawView=!1,this.shouldUpdateGrid=!1,this.frameRequestId=requestAnimationFrame(this.draw)}),this.resizeCanvas=(()=>{const t=this,e=t.clientWidth,s=t.clientHeight;t.width===e&&t.height===s||(t.width=e,t.height=s,this.cachedGrid.width=e,this.cachedGrid.height=s,this.shouldUpdateGrid=!0)}),this.doubleClick=(t=>{const e=this.getOffsetFromCenter(t);this.panTo(e)}),this.singleClick=(t=>{const e=this.getOffsetFromTopLeft(t),s=this.toGameCoor(e),n=this.db,o=n.search(s);for(const[t,e]of o)switch(e.massKind){case 1:n.switchPlanetTab(t);break;case 0:break;default:throw new Error("not handled")}}),this.wheel=(t=>{const e=t.deltaY<0,s=this.db.galaxyViewData,n=s.gridSize;s.gridSize=e?Math.min(P,n+1):Math.max(_,n-1),this.shouldUpdateGrid=!0}),this.pan=(t=>{this.panTo([t.deltaX,t.deltaY])}),console.assert(void 0!==this.ctx);this.className="map",window.addEventListener("resize",this.resizeCanvas,!0);const e=new H.Manager(this),s=new H.Tap({event:"doubletap",taps:2}),n=new H.Tap({event:"singletap"}),o=(new H.Pan).set({direction:H.DIRECTION_ALL});e.add([new H.Pinch,s,n,o]),s.recognizeWith(n),n.requireFailure(s),e.on("singletap",this.singleClick),e.on("doubletap",this.doubleClick),e.on("pinch",this.wheel),e.on("pan",this.pan),this.addEventListener("wheel",this.wheel,{passive:!0}),this.draw()}update(t){t.has(0)&&(this.shouldRedrawView=!0)}suspend(){if(void 0===this.frameRequestId)throw console.assert(!1),new Error("no need to suspend drawing");window.cancelAnimationFrame(this.frameRequestId),this.frameRequestId=void 0}resume(){if(void 0!==this.frameRequestId)throw console.assert(!1),new Error("no need to resume drawing");this.draw()}getOffsetFromTopLeft(t){const e=t.target.getBoundingClientRect();return[t.center.x-e.left,t.center.y-e.top]}getOffsetFromCenter(t){return[t.center.x-this.width/2,t.center.y-this.height/2]}toVpCoor([t,e]){const s=this.db.galaxyViewData,n=s.gridSize,o=s.center,[r,i]=o,a=this.width/2,c=this.height/2;return[Math.floor((t+r)*n+a),Math.floor((e+i)*n+c)]}toGameCoor([t,e]){const s=this.db.galaxyViewData,n=s.gridSize,o=s.center,r=this.width/2,i=this.height/2,[a,c]=o;return[(t-r)/n-a,(e-i)/n-c]}get vpCenter(){const t=this.db.galaxyViewData.center;return this.toVpCoor(t)}drawPlanets(t,e){const s=this.db.galaxyViewData.gridSize,n=e.map(([e,n])=>{const o=t.planets.get(e);return console.assert(void 0!==o),{coor:n,id:e,planet:o,radius:o.radius*s}}).filter(({radius:t})=>t>=1).map(t=>Object.assign({},t,{vpCoor:this.toVpCoor(t.coor)})),o=this.ctx;o.save(),o.strokeStyle="white",o.setLineDash([5,3]);for(const{planet:e,vpCoor:s}of n){const n=t.locs.get(e.center);console.assert(void 0!==n);const i=this.toVpCoor(n),a=Object(r.distance)(i,s),[c,l]=i;this.isCircleInView(i,a)&&(o.beginPath(),o.arc(c,l,a,0,z),o.stroke())}o.fillStyle="green";for(const{radius:t,vpCoor:e}of n){const[s,n]=e;this.isCircleInView(e,t)&&(o.beginPath(),o.arc(s,n,t,0,z),o.fill())}o.textAlign="center",o.textBaseline="middle";for(const{planet:t,radius:e,vpCoor:s}of n){const n=o.measureText(t.name),i=20,a=n.width,[c,l]=s,h=c,u=l-e-5,d=Object(r.subtract)([h,u],[a/2,i/2]);this.isRectInView(d,n.width,i)&&o.fillText(t.name,h,u)}o.restore()}isCircleInView(t,e){const s=2*e,n=Object(r.subtract)(t,[e,e]);return this.isRectInView(n,s,s)}isRectInView(t,e,s){const n=this.width,o=this.height,[r,i]=t;return 0<r+e&&n>r&&0<i+s&&o>i}drawStars(t,e){const s=this.db.galaxyViewData.gridSize,n=this.ctx;n.save(),n.fillStyle="yellow";for(const[o,[r,i]]of e){const e=t.stars.get(o);console.assert(void 0!==e);const[a,c]=this.toVpCoor([r,i]),l=Math.max(1,e.radius*s);n.beginPath(),n.arc(a,c,l,0,z),n.fill()}for(const[o,[i,a]]of e){const e=t.stars.get(o);console.assert(void 0!==e);const[c,l]=this.toVpCoor([i,a]),h=Math.max(1,e.radius*s);n.beginPath(),n.arc(c,l,h,0,z),n.fill(),n.textAlign="center",n.textBaseline="middle";const u=n.measureText(e.name),d=20,f=u.width,p=c,m=l-h-5,w=Object(r.subtract)([p,m],[f/2,d/2]);this.isRectInView(w,u.width,d)&&n.fillText(e.name,p,m)}n.restore()}drawObjects(){const t=this.db.galaxy,e=[];{const[s,n]=this.toGameCoor([0,0]),o=Math.floor(s/i),r=Math.floor(n/i),[a,c]=this.toGameCoor([this.width,this.height]),l=Math.ceil(a/i),h=Math.ceil(c/i);for(let s=o;s<=l;s++)for(let n=r;n<=h;n++){const o=v(s,n),r=t.cachedLocIdx.get(o);void 0!==r&&e.push(...r)}}const s=Object(r.groupBy)(Object(r.makeSet)(e).map(e=>Object(r.makePair)(e,t.locs.get(e))),([e])=>{const s=w(t,e);return console.assert(void 0!==s),s.massKind});for(const[e,n]of s)switch(e){case 0:this.drawStars(t,n);break;case 1:this.drawPlanets(t,n)}}updateCachedGrid(){const t=this.cachedGrid,e=t.getContext("2d");if(!e)throw new Error("cannot create context");const s=this.db.galaxyViewData,n=s.gridSize,o=s.center;e.clearRect(0,0,t.width,t.height),e.save(),e.lineWidth=1,e.strokeStyle="#494949",e.translate(.5,.5);const[r,i]=o,a=Math.floor(r),c=Math.floor(i),[l,h]=this.toVpCoor([a,c]);if(n>=E){const s=Math.ceil(this.width/n);let o=l%n;e.beginPath();for(let r=0;r<=s;r++)e.moveTo(o,0),e.lineTo(o,t.height),o+=n;const r=Math.ceil(this.height/n);let i=h%n;for(let s=0;s<=r;s++)e.moveTo(0,i),e.lineTo(t.width,i),i+=n;e.stroke()}e.restore(),e.save(),e.translate(.5,.5),e.strokeStyle=n>=E?"white":"#494949";{const s=a-a%j,o=c-c%j,r=j*n,[i,l]=this.toVpCoor([s,o]);e.beginPath();const h=Math.ceil(this.width/r);let u=i%r;for(let s=0;s<=h;s++)e.moveTo(u,0),e.lineTo(u,t.height),u+=r;const d=Math.ceil(this.height/r);let f=l%r;for(let s=0;s<=d;s++)e.moveTo(0,f),e.lineTo(t.width,f),f+=r;e.stroke()}e.restore()}panTo(t){this.updatePanAnimation=void 0;const e=this.db,s=this.vpCenter,n=this.toGameCoor(s),o=Object(r.add)(t,s),i=this.toGameCoor(o),a=e.galaxyViewData,c=Object(r.subtract)(i,n),l=.01/a.gridSize;let h=Object(r.norm)(c);this.updatePanAnimation=(()=>{const t=.05*h;let e;if(0===t)return;t<l?(this.updatePanAnimation=void 0,e=h):(e=t,h-=t);const s=Object(r.project)(c,e);a.center=Object(r.subtract)(a.center,s)})}}function R(t,e){t.textContent!==e&&(t.textContent=e)}function G(t){for(;t.lastChild;)t.removeChild(t.lastChild)}customElements.define("map-view",D,{extends:"canvas"});const F=document.getElementById("nationView");console.assert(null!==F);class L extends HTMLElement{constructor(t){super(),this.db=t,this.attachShadow({mode:"open"}).appendChild(F.content.cloneNode(!0))}update(t){}}customElements.define("nation-view",L);const N=document.getElementById("peopleView");console.assert(null!==N);class q extends HTMLElement{constructor(t){super(),this.db=t,this.attachShadow({mode:"open"}).appendChild(N.content.cloneNode(!0))}update(t){}}function B(t,e,s){return s*t.width+e}customElements.define("people-view",q);const K=document.getElementById("colonyView");console.assert(null!==K);class W extends HTMLFieldSetElement{constructor(t,e){super(),this.db=t,this.colonyId=e,this.appendChild(K.content.cloneNode(!0));const s=t.galaxy.colonyGovs.get(e);console.assert(void 0!==s);const n=this.querySelector(".marketTable");console.assert(null!==n);const o=this.querySelector(".marketRow");console.assert(null!==o);const r=function(t){const e=document.createDocumentFragment();for(const s of t)e.appendChild(s);return e}(p().map(t=>{const e=o.content.cloneNode(!0),s=e.querySelector(".comType");console.assert(null!==s),s.textContent=u[t];const n=e.querySelector(".comDemand");console.assert(null!==s),n.textContent=String(0);const r=e.querySelector(".comSupply");return console.assert(null!==s),r.textContent=String(0),e}));n.appendChild(r)}update(t){const e=this.db.galaxy,s=this.colonyId,n=e.colonyGovs.get(s);console.assert(void 0!==n)}}customElements.define("colony-view",W,{extends:"fieldset"});const U=document.getElementById("planetView");console.assert(null!==U);class J extends HTMLElement{constructor(t,e){super(),this.db=t,this.planetId=e,this.colonyViews=new Map,this.setHoverTileIdx=(t=>()=>{this.tileId=t,this.updateHelper()});const s=this.attachShadow({mode:"open"});s.appendChild(U.content.cloneNode(!0)),this.tbody=s.querySelector(".map"),console.assert(null!==this.tbody),this.planetName=s.querySelector(".name"),console.assert(null!==this.tbody),this.tile=s.querySelector(".tile"),console.assert(null!==this.tile),this.polOwner=s.querySelector(".polOwner"),console.assert(null!==this.polOwner),this.container=s.querySelector(".container"),console.assert(null!==this.container),this.layout()}update(t){const e=this.db,s=e.galaxy,n=(function(t,e){const s=t.planets.get(e);console.assert(void 0!==s)}(s,this.planetId),s.planetColonyMap.get(this.planetId));void 0!==n&&(console.assert(s.colonyGovs.has(n)),void 0===this.colonyView?(this.colonyView=new W(e,n),this.container.appendChild(this.colonyView)):n!==this.colonyView.colonyId&&(this.colonyView.remove(),this.colonyView=new W(e,n),this.container.appendChild(this.colonyView)),this.colonyView.update(t));for(const e of this.colonyViews.values())e.update(t);this.updateHandler&&this.updateHandler(t)}updateHelper(){const t=this.tileId,e=this.planetId;if(void 0!==t){const s=this.db.galaxy,n=s.planets.get(e);console.assert(void 0!==n);const o=function(t,e){return[e%t.width,Math.floor(e/t.width)]}(n,t);R(this.tile,`${o}`);const r=n.zones[t],i=s.zones.get(r);console.assert(void 0!==i);const a=s.planetColonyMap.get(e);if(void 0!==a){const t=s.colonyGovs.get(a),e=s.nations.get(t.allegiance);console.assert(void 0!==t),R(this.polOwner,e.name)}else R(this.polOwner,"")}}layout(){G(this.tbody);const t=this.db.galaxy,e=t.planets.get(this.planetId);console.assert(void 0!==e),R(this.planetName,e.name);const s=e.width,n=e.height,o=document.createDocumentFragment();for(let r=0;r<n;r++){const n=document.createElement("tr");o.appendChild(n);for(let o=0;o<s;o++){const s=document.createElement("td");n.appendChild(s);const i=B(e,o,r),a=e.zones[i],c=t.zones.get(a);console.assert(void 0!==c),s.textContent="A",s.onclick=this.setHoverTileIdx(i)}}this.tbody.appendChild(o)}}customElements.define("planet-view",J);const $=document.getElementById("playerView");console.assert(null!==$);class X extends HTMLElement{constructor(t){super(),this.db=t,this.attachShadow({mode:"open"}).appendChild($.content.cloneNode(!0))}update(t){}}customElements.define("player-view",X);const Y=document.getElementById("searchView");console.assert(null!==Y);const Z=document.getElementById("resultItem");console.assert(null!==Z);class Q extends HTMLElement{constructor(t){super(),this.db=t,this.handleKeyup=(()=>{const t=this.db,e=this.searchTerm.value;console.log(e),t.searchName=e});const e=this.attachShadow({mode:"open"});e.appendChild(Y.content.cloneNode(!0)),this.searchTerm=e.querySelector(".searchTerm"),console.assert(null!==this.searchTerm),this.searchTerm.onkeyup=this.handleKeyup,this.searchResult=e.querySelector(".result"),console.assert(null!==this.searchResult),this.refreshResults()}update(t){this.db;t.has(3)&&this.refreshResults()}refreshResults(){G(this.searchResult);const t=this.db,e=t.galaxy,s=document.createDocumentFragment();for(const[n,o]of t.searchNameResult){const r=document.createDocumentFragment();r.appendChild(Z.content.cloneNode(!0));const i=r.querySelector(".resultItem");console.assert(null!==i);const a=r.querySelector(".name");switch(console.assert(null!==a),o){case 0:{const s=e.planets.get(n);if(void 0===s)continue;i.onclick=(()=>{t.switchPlanetTab(n)}),a.textContent=s.name}break;case 1:{const t=e.stars.get(n);if(void 0===t)continue;a.textContent=t.name}break;case 2:{const t=e.nations.get(n);if(void 0===t)continue;a.textContent=t.name}break;case 3:{const s=e.colonyGovs.get(n);if(void 0===s)continue;const o=s.locatedSrc,r=e.planets.get(o);console.assert(void 0!==r),i.onclick=(()=>{t.switchPlanetTab(o)}),a.textContent=`Colony, ${r.name}`}break;default:throw new Error("not handled")}s.appendChild(r)}this.searchResult.appendChild(s)}}customElements.define("search-view",Q);const tt=document.getElementById("stationView");console.assert(null!==tt);class et extends HTMLElement{constructor(t){super(),this.db=t;const e=this.attachShadow({mode:"open"});e.appendChild(tt.content.cloneNode(!0)),this.tbody=e.querySelector(".map"),console.assert(null!==this.tbody),this.name=e.querySelector(".name"),console.assert(null!==this.tbody),this.layout()}update(t){this.updateHandler&&this.updateHandler(t)}layout(){G(this.tbody),R(this.name,"Station 1");const t=document.createDocumentFragment();for(let e=0;e<1;e++){const e=document.createElement("tr");t.appendChild(e);for(let t=0;t<2;t++){const t=document.createElement("td");e.appendChild(t),t.textContent="A"}}this.tbody.appendChild(t)}}customElements.define("station-view",et);const st=document.getElementById("switchView");console.assert(null!==st);class nt extends HTMLElement{constructor(t){super(),this.db=t,this.tabChildren=new Map,this.switch=(t=>{const e=this.db;if(void 0===this.curView)this.switchHelper(this.createGalaxyView());else switch(t.kind){case 0:this.curView.kind!==t.kind&&this.switchHelper(this.createGalaxyView());break;case 1:switch(this.curView.kind){case 1:if(this.curView.planetId===t.planetId)return;break;case 0:this.curView.view.suspend()}this.switchHelper(Object.assign({},t,{view:new J(e,t.planetId)}));break;case 2:switch(this.curView.kind){case 0:this.curView.view.suspend();break;case 2:return}this.switchHelper(Object.assign({},t,{view:new Q(e)}));break;case 3:switch(this.curView.kind){case 0:this.curView.view.suspend();break;case 3:return}this.switchHelper(Object.assign({},t,{view:new X(e)}));break;case 4:switch(this.curView.kind){case 0:this.curView.view.suspend();break;case 4:return}this.switchHelper(Object.assign({},t,{view:new L(e)}));break;case 5:switch(this.curView.kind){case 0:this.curView.view.suspend();break;case 5:return}this.switchHelper(Object.assign({},t,{view:new et(e)}));break;case 6:switch(this.curView.kind){case 0:this.curView.view.suspend();break;case 6:return}this.switchHelper(Object.assign({},t,{view:new q(e)}));break;default:throw new Error("not handled")}e.moveTabToFront(t.tabId),this.updateTabs();const s=e.tabId;for(const[t,e]of this.tabChildren)t===s?e.classList.add("selected"):e.classList.remove("selected")});const e=this.attachShadow({mode:"open"});e.appendChild(st.content.cloneNode(!0)),this.tabs=e.querySelector(".tabs"),console.assert(null!==this.tabs),this.container=e.querySelector(".container"),console.assert(null!==this.container);const s=t.tabs[0];console.assert(0===s.kind),this.switch(s)}update(t){if(t.has(1)&&this.updateTabs(),t.has(2)){const t=this.db;if(t.tabId!==this.curView.tabId){const e=t.tabs.find(e=>e.tabId===t.tabId);console.assert(void 0!==e),this.switch(e)}}this.curView.view.update(t)}updateTabs(){G(this.tabs);const t=this.tabChildren;this.tabChildren=new Map;for(const e of this.db.tabs){let s=t.get(e.tabId);if(s)this.tabChildren.set(e.tabId,s);else{switch((s=document.createElement("div")).onclick=(()=>this.db.tabId=e.tabId),e.kind){case 0:s.textContent="Galaxy";break;case 1:{const t=this.db.galaxy.planets.get(e.planetId);console.assert(void 0!==t),s.textContent=t.name}break;case 2:s.textContent="Search";break;case 3:s.textContent="Player";break;case 4:s.textContent="Nation";break;case 5:s.textContent="Station";break;case 6:s.textContent="People";break;default:throw new Error("not handled")}this.tabChildren.set(e.tabId,s)}this.tabs.appendChild(s)}}switchHelper(t){G(this.container),this.curView=t,this.container.appendChild(t.view)}createGalaxyView(){const t=this.db;return console.assert(t.tabs.length>0&&0===t.tabs[0].kind),{kind:0,tabId:t.tabs[0].tabId,view:new D(this.db)}}}customElements.define("switch-view",nt),A.a.new().print_planets();const ot=document.body;function rt(){const t=x(),e=Symbol();t.people.set(e,{name:"Player"});const s=Symbol();return t.corps.set(s,{issuedShare:1e4,kind:n.Corporate,name:"Company",opRights:new Set}),t.stock.set(s,new Map([[e,1e4]])),{galaxy:t,player:e}}console.assert(null!==ot);const it=new class{constructor(t){this.galaxyViewData={center:[0,0],gridSize:_},this.cacheSearchResult=[],this.subscribers=new Set,this.flags=new Set,this.dictionary=new r.Dictionary,this.reset(t)}reset(t){this.galaxyState=t.galaxy,this.playerId1=t.player;const e=V.slice(),s=e[0].tabId;this.curTabId=s,this.setTabsHelper(e),this.buildDict(),this.cacheSearchResult=[],this.notify(...T)}buildDict(){const t=this.galaxyState;[Object(r.makePair)(0,t.planets),Object(r.makePair)(1,t.stars),Object(r.makePair)(2,t.nations)].forEach(([t,e])=>{for(const[s,n]of e)this.dictionary.set(n.name,s,t)});const e=new Map(Array.from(t.colonyGovs.keys()).map(t=>Object(r.makePair)(t,3)));this.dictionary.batchSet("colony",e)}set searchName(t){clearInterval(this.searchNameId),this.searchNameId=setInterval(()=>{this.cacheSearchResult=Array.from(this.dictionary.search(t)),this.notify(3),clearInterval(this.searchNameId)},300)}get searchNameResult(){return this.cacheSearchResult}get tabId(){return this.curTabId}set tabId(t){this.switchTabHelper(t),this.notify()}set galaxy(t){console.assert(null!==t&&void 0!==t),this.galaxyState=t,this.notify(0)}get galaxy(){return this.galaxyState}get playerId(){return this.playerId1}get tabs(){return this.tabState.slice()}addPlanetTab(t){const e=this.tabState,s=e.find(e=>1===e.kind&&e.planetId===t);if(void 0!==s)return s.tabId;const n=Symbol();return e.push({kind:1,planetId:t,tabId:n}),this.setTabsHelper(e),n}switchPlanetTab(t){const e=this.addPlanetTab(t);this.switchTabHelper(e),this.notify()}moveTabToFront(t){const e=V.length,s=this.tabState.slice(0,e);if(s.some(e=>e.tabId===t))return;const n=this.tabState.find(e=>e.tabId===t);console.assert(void 0!==n);const o=this.tabState.slice(e).filter(e=>e.tabId!==t);this.tabState=[...s,n,...o];const r=e+10,i=this.tabState.length;i>r&&(console.assert(i===r+1),this.tabState.pop())}get data(){return{galaxy:this.galaxy,player:this.playerId}}tick(){this.galaxy=function(t){let e=Object.assign({},t,{tick:t.tick+1});return e=function(t){let e=t;return e=function(t){return t}(e=function(t){return t}(e)),t}(e=k(e=M(e=function(t){return t}(e=function(t){return t}(e)))))}(this.galaxy)}search(t){const[e,s]=t,n=this.galaxy,o=n.cachedLocIdx,a=[Math.floor(e),Math.floor(s)],c=[a,...function([t,e]){return[[t,e-1],[t,e+1],[t-1,e],[t+1,e],[t-1,e-1],[t+1,e-1],[t-1,e+1],[t+1,e+1]]}(a)];return console.assert(o.size>0),Object(r.makeSet)(Object(r.wrapIt)(c).map(([t,e])=>o.get(function(t,e){return v(t/i,e/i)}(t,e))).filter(t=>void 0!==t).flatMap(t=>t)).map(t=>Object(r.makePair)(t,w(n,t))).filter(([e,s])=>{const o=n.locs.get(e);return console.assert(void 0!==o),Object(r.distance)(o,t)<=s.radius})}runAi(){const t=this.galaxyState;for(const[e,s]of t.people)e!==this.playerId&&O(this.galaxyState,0,s)}addFlags(...t){Object(r.unionMut)(this.flags,...t)}notify(...t){this.addFlags(...t);for(const t of this.subscribers)t.update(this.flags);this.flags.clear()}add(...t){for(const e of t)console.assert(!this.subscribers.has(e),"double-subscribing the same subscriber"),this.subscribers.add(e);this.notify(...T)}delete(t){const e=this.subscribers.delete(t);console.assert(e,"unsubscribing a non-exist subscriber"),this.notify(...T)}clear(){this.subscribers.clear(),this.notify(...T)}setTabsHelper(t){console.assert(null!==t&&void 0!==t),this.tabState=t.slice(),this.addFlags(1)}switchTabHelper(t){const e=this.tabState.some(e=>e.tabId===t);console.assert(e),this.curTabId!==t&&(this.curTabId=t,this.addFlags(2))}}(rt()),at=new nt(it),ct=document.createElement("input");ct.value="Debugger",ct.type="button",ct.onclick=(()=>{});const lt=document.createElement("input");lt.value="Restart",lt.type="button",lt.onclick=(()=>{it.reset(rt())});const ht=document.createElement("input");ht.value="End Turn",ht.type="button",ht.onclick=(()=>it.tick());const ut=document.createElement("div");ut.className="restPanel",ut.appendChild(ct),ut.appendChild(lt),ut.appendChild(ht),ot.appendChild(at),ot.appendChild(ut),it.add(at),setInterval(()=>it.tick(),100),setInterval(()=>it.runAi(),5e3)},function(t,e,s){"use strict";function*n(t,e){let s=0;for(const n of t)yield e(n,s),++s}function*o(t,e){let s=0;for(const n of t){for(const t of e(n,s))yield t;++s}}function r(t,e,s){let n=s,o=0;for(const s of t)n=e(n,s,o),++o;return n}function*i(t,e){let s=0;for(const n of t){if(s>=e)break;yield n,++s}}function a(t,e){let s=0;for(const n of t){if(!e(n,s))return!1;++s}return!0}function c(t,e){let s=0;for(const n of t){if(e(n,s))return!0;++s}return!1}function l(t,e){let s=0;for(const n of t){if(!1===e(n,s))return;++s}}function*h(t,e){let s=0;for(const n of t)e(n,s)&&(yield n),++s}function*u(t,e){let s,n=!0;for(const o of t)n?(n=!1,s=o):(yield e(s,o),s=o)}function d(t){let e=0;for(const s of t)++e;return e}function f(t){return p(t).take(1).collect()[0]}function p(t){return{collect:()=>Array.from(t),count:()=>d(t),every:e=>a(t,e),filter:e=>p(h(t,e)),first:()=>f(t),flatMap:e=>p(o(t,e)),forEach:e=>l(t,e),map:e=>p(n(t,e)),pin:e=>p(u(t,e)),reduce:(e,s)=>r(t,e,s),some:e=>c(t,e),take:e=>p(i(t,e)),*[Symbol.iterator](){for(const e of t)yield e}}}Object.defineProperty(e,"__esModule",{value:!0}),e.wrapIt=p;e.MyIterable=class{constructor(){this.collect=(()=>Array.from(this)),this.count=(()=>d(this)),this.first=(()=>f(this)),this.flatMap=(t=>p(o(this,t))),this.map=(t=>p(n(this,t))),this.pin=(t=>p(u(this,t))),this.reduce=((t,e)=>r(this,t,e)),this.some=(t=>c(this,t)),this.every=(t=>a(this,t)),this.filter=(t=>p(h(this,t))),this.forEach=(t=>l(this,t)),this.take=(t=>p(i(this,t)))}*[Symbol.iterator](){for(const t of this.iterate())yield t}get isEmpty(){return 0===this.size}}},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(22)),n(s(13)),n(s(24)),n(s(29)),n(s(8)),n(s(35)),n(s(39)),n(s(40)),n(s(41)),n(s(21)),n(s(42)),n(s(46)),n(s(5))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);class o extends n.MyIterable{constructor(t){super(),this.cmp=t,this.arr=[],this.pop=(()=>{const t=c(this.arr,this.arr.length,this.cmp),e=this.arr.pop();return console.assert(t===e),t}),this.reverseSort=(()=>{const t=this.arr;this.arr=[];for(let e=t.length;e>0;e--)c(t,e,this.cmp);return t}),this.sortInPlace=(()=>{const t=this.reverseSort();let e=0,s=t.length-1;for(;e<s;)a(t,e,s),++e,--s;return t}),this.sort=(()=>{const t=this.sortHelper();return n.wrapIt(t)}),this.add=(t=>{const e=this.arr.length;this.arr.push(t),function(t,e,s){console.assert(e===t.length-1);let n=e;for(;n>0;){const e=r(n);s(t[n],t[e])<0&&a(t,n,e),n=e}}(this.arr,e,this.cmp)}),this.iterate=(()=>this.sortHelper()),this.sortHelper=(()=>(function*(t,e){const s=t;let n=c(s,s.length,e);for(;void 0!==n;)yield s.pop(),n=c(s,s.length,e)})(this.arr.slice(),this.cmp))}static heapify(t,...e){return o.inPlaceWrap(t,e)}static inPlaceWrap(t,e){return o.unsafeWrap(function(t,e){for(let s=Math.floor((t.length-1)/2);s>=0;s--)l(t,s,t.length,e);return t}(e,t),t)}static unsafeWrap(t,e){const s=new o(e);return s.arr=t,s}get size(){return this.arr.length}get top(){return this.isEmpty?void 0:this.arr[0]}}function r(t){return Math.floor((t+1)/2)-1}function i(t){return 2*t+1}function a(t,e,s){const n=t[e];t[e]=t[s],t[s]=n}function c(t,e,s){const n=e-1;if(0===e)return;if(1===e)return t[n];const o=t[0];return a(t,0,n),l(t,0,n,s),o}function l(t,e,s,n){const o=t[e];let r=e;for(;;){let e=i(r);if(e>=s)break;const c=t[e],l=e+1;if(l<s&&n(t[l],c)<0&&(e=l),n(o,t[e])<0)break;a(t,r,e),r=e}}e.MinHeap=o},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.makePair=function(t,e){return[t,e]}},function(t,e,s){"use strict";s.d(e,"b",function(){return c}),s.d(e,"c",function(){return h}),s.d(e,"a",function(){return u}),s.d(e,"d",function(){return d});var n=s(48);const o=console.log;let r=new("object"==typeof self&&self.TextDecoder?self.TextDecoder:s(49).TextDecoder)("utf-8"),i=null;function a(t,e){return r.decode((null!==i&&i.buffer===n.d.buffer||(i=new Uint8Array(n.d.buffer)),i).subarray(t,t+e))}function c(t,e){let s=a(t,e);o(s)}const l=Math.random;function h(){return l()}class u{static __construct(t){return new u(t)}constructor(t){this.ptr=t}free(){const t=this.ptr;this.ptr=0,n.a(t)}static new(){return u.__construct(n.b())}print_planets(){if(0===this.ptr)throw new Error("Attempt to use a moved value");return n.c(this.ptr)}}function d(t,e){throw new Error(a(t,e))}},function(t,e,s){"use strict";function n(t,e,s,n,o,r){for(;o<=r;){const i=Math.floor((o+r)/2),a=n(s(t[i]),e);if(!Number.isFinite(a))throw new Error("cmp doesn't return finite number");if(a<0)o=i+1;else{if(!(a>0))return[i,o,r];r=i-1}}return[void 0,o,r]}function o(t,e,s,o,r,i){let a=r,c=i;for(;;){const r=a-1,[i,l]=n(t,e,s,o,c,r);if(void 0===i)return a;console.assert(i<=r),a=i,c=l}}function r(t,e,s,o,r,i){let a=r,c=i;for(;;){const r=a+1,[i,,l]=n(t,e,s,o,r,c);if(void 0===i)return a;console.assert(i>=r),a=i,c=l}}function i(t,e,s,r){if(0===t.length)return 0;const[i,a]=n(t,e,s,r,0,t.length-1);return void 0===i?a:o(t,e,s,r,i,a)}function a(t,e,s,o){if(0===t.length)return 0;const[i,a,c]=n(t,e,s,o,0,t.length-1);return void 0===i?a:r(t,e,s,o,i,c)}function c(t,e,s,i){if(0!==t.length){const[a,c,l]=n(t,e,s,i,0,t.length-1);if(void 0===a)return;return[o(t,e,s,i,a,c),r(t,e,s,i,a,l)]}}Object.defineProperty(e,"__esModule",{value:!0}),e.lowerBound=i,e.upperBound=a,e.binarySearch=c,e.binarySearchExist=function(t,e,s,o){if(0===t.length)return;const[r]=n(t,e,s,o,0,t.length-1);return void 0!==r},e.binaryInsert=function(t,e,s,n){if(0===t.length)return[e];const o=i(t,s(e),s,n),r=t.splice(o,0,e);return console.assert(0===r.length),t},e.binaryDelete=function(t,e,s,n){if(0!==t.length){const o=c(t,e,s,n);if(void 0!==o){const[e,s]=o,n=s-e+1;t.splice(e,n)}}return t},e.binarySearchRange=function(t,e,s,n,o){if(0===t.length)return;let r,l;const h=o(e,s);if(h<0)r=e,l=s;else{if(!(h>0))return c(t,e,n,o);r=s,l=e}const u=i(t,r,n,o);let d=a(t,l,n,o);return d===t.length&&t.length>0&&(d=t.length-1),console.assert(u<=d),[u,d]}},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(9)),n(s(27)),n(s(28)),n(s(2))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.combine=function(...t){return n.wrapIt(function*(t){for(const e of t)for(const t of e)yield t}(t))}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(15),o=s(2),r=s(5);function*i(t){const e=n.dfsPreOrder(t,t=>t.next.values()),s=[];let o=0;for(const[t,n]of e){const e=o-n;for(let t=0;t<e;++t)s.pop(),o--;void 0!==t.keyChar?s.push(t.keyChar):console.assert(0===n),++o,void 0!==t.val&&(yield r.makePair(s.slice(),t.val))}}e.Trie=class extends o.MyIterable{constructor(...t){super(),this.root={next:new Map},this.trieSize=0,this.get=(t=>{const e=this.traverse(t);return void 0===e?void 0:e.val}),this.has=(t=>void 0!==this.get(t)),this.delete=(t=>{const e=[],s=this.traverse(t,(t,s)=>e.push([t,s]));if(void 0===s||void 0===s.val)return!1;--this.trieSize;let n=s;for(let t=e.length-1;t>=0&&0===n.next.size;t--){const[s,o]=e[t];console.assert(o.next.size>0),o.next.delete(s),n=o}return!0}),this.set=((t,e)=>{let s=this.root;return t.forEach(t=>{if(void 0===t)throw new Error("undefined not allowed as part of the key");let e=s.next.get(t);void 0===e&&(e={next:new Map},s.next.set(t,e)),e.keyChar=t,s=e}),s.val=e,++this.trieSize,this}),this.getOrSet=((t,e)=>{let s=this.root;if(t.some(t=>void 0===t))throw new Error("undefined is not allowed to be part of the key");for(const e of t){let t=s.next.get(e);void 0===t&&(t={next:new Map},s.next.set(e,t)),t.keyChar=e,s=t}return void 0===s.val&&(s.val=e(),++this.trieSize),s.val}),this.keys=(()=>o.wrapIt(i(this.root)).map(([t])=>t)),this.values=(()=>o.wrapIt(i(this.root)).map(([,t])=>t)),this.getFanout=(t=>{const e=this.traverse(t);return e?e.next.size:0}),this.iterate=(()=>i(this.root)),this.traverse=((t,e=(()=>{}))=>{let s=this.root;for(const n of t){const t=s.next.get(n);if(void 0===t)return;e(n,s),s=t}return s});for(const[e,s]of t)this.set(e,s)}get size(){return this.trieSize}get isEmpty(){return 0===this.size}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(9),o=s(2),r=s(17),i=s(19);e.intersect=((...t)=>i.wrapSet(function(...t){switch(t.length){case 0:return new Set;case 1:return new Set(t[0]);case 2:let e,s;return t[0].size>t[1].size?(e=t[1],s=t[0]):(e=t[0],s=t[1]),new Set(o.wrapIt(e).filter(t=>s.has(t)));default:return new Set(o.wrapIt(r.groupBy(n.combine(...t),t=>t)).filter(([,e])=>t.length===e.length).map(([t])=>t))}}(...t)))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(4),o=s(7);e.mergeK=function(t,e,...s){const r=s.filter(t=>t.length>0);switch(r.length){case 0:return[];case 1:return r[0].slice();case 2:const s=r[0],n=r[1];return 1===s.length?o.binaryInsert(n.slice(),s[0],t,e):1===n.length?o.binaryInsert(s.slice(),n[0],t,e):Array.from(function(t,e,s,n){console.assert(t.length>0&&e.length>0);let o=0,r=0;const i=[];for(;;){const a=t[o],c=e[r];if(n(s(a),s(c))<0?(i.push(a),++o):(i.push(c),++r),o===t.length)return i.concat(e.slice(r));if(r===e.length)return i.concat(t.slice(o))}}(s,n,t,e))}const i=n.MinHeap.inPlaceWrap(([s,n],[o,r])=>e(t(s[n]),t(o[r])),r.map((t,e)=>[r[e],0])),a=[];for(;;){const[t,e]=i.pop();a.push(t[e]);const s=e+1;if(0===i.size)return s<t.length?a.concat(t.slice(s)):a;s<t.length&&i.add([t,s])}}},function(t,e,s){"use strict";function n(t,e){let s,n;return t>e?(s=e,n=t):(s=t,n=e),[s,n]}Object.defineProperty(e,"__esModule",{value:!0}),e.clamp=function(t,e,s){const[o,r]=n(e,s);return Math.min(r,Math.max(o,t))},e.defaultZero=function(t){return void 0===t?0:t},e.position=function(t,e,s){const[o,r]=n(e,s),i=t-o,a=r-o;return i<0?0:0===a?1:Math.min(1,i/a)}},function(t,e,s){"use strict";function n(t,e,s){const[n]=o(t,e,s);return n}function o(t,e,s){let n=0;for(;;){if(n===e.length)return n===s.length?[0,void 0]:[-1,n];if(n===s.length)return[1,n];const o=t(e[n],s[n]);if(0!==o)return[o,n];++n}}Object.defineProperty(e,"__esModule",{value:!0}),e.cmpList=n,e.listEqual=function(t,e,s){return 0===n(t,e,s)},e.listDiff=function(t,e,s){const[,n]=o(t,e,s);return n}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);function*o(t,e){const s=[[t,0]],n=new Set;for(;s.length>0;){const[t,o]=s.pop();if(!n.has(t)){yield[t,o],n.add(t);const r=o+1;for(const n of e(t))s.push([n,r])}}}e.dfsPreOrder=function(t,e){return n.wrapIt(o(t,e))},e.dfsPreOrderHelper=o},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);class o extends n.MyIterable{constructor(){super(...arguments),this.toId=new Map,this.parents=new Map,this.id=0,this.union=((...t)=>{if(t.length>0){const e=t[0];for(let s=1;s<t.length;++s){const n=t[s];this.union2(e,n)}}return this}),this.isSameSet=((t,e)=>{if(console.assert(void 0!==t),console.assert(void 0!==e),t===e)return!0;const s=this.find(t);if(void 0===s)return!1;const n=this.find(e);if(void 0===n)return!1;const[o]=s,[r]=n;return o===r}),this.tear=((...t)=>{for(const e of t)this.toId.delete(e)&&(this.memoizedSets=void 0,this.add(e));return this.recycle(),this}),this.delete=(t=>{const e=this.toId.delete(t);return e&&(this.memoizedSets=void 0),this.recycle(),e}),this.clone=(()=>{const t=new o;return t.toId=new Map(this.toId),t.parents=new Map(this.parents),t.id=this.id,t}),this.deleteSets=((...t)=>{let e=!1;for(const s of t)for(const t of this.get(s)){const s=this.toId.get(t);this.parents.delete(s),this.toId.delete(t),e=!0}e&&(this.memoizedSets=void 0),this.recycle()}),this.has=(t=>void 0!==this.find(t)),this.iterate=(()=>(void 0===this.memoizedSets&&(this.memoizedSets=this.aggregate()),this.memoizedSets.values())),this.aggregate=(()=>{const t=new Map;for(const[e,s]of this.toId){const[n]=this.findInner(s),o=t.get(n);void 0===o?t.set(n,new Set([e])):o.add(e)}return t}),this.findMut=(t=>{const e=this.toId.get(t);return void 0===e?this.add(t):this.findInner(e)}),this.union2=((t,e)=>{console.assert(void 0!==t),console.assert(void 0!==e),this.memoizedSets=void 0;const[s,n]=this.findMut(t),[o,r]=this.findMut(e);return s===o?this:(n<r?this.parents.set(s,[o,n]):n>r?this.parents.set(o,[s,r]):this.parents.set(s,[o,r+1]),this.recycle(),this)}),this.recycle=(()=>{if(this.garbageRatio<2)return;this.memoizedSets=void 0;const t=new o;for(const e of this){const s=e.values().next().value;console.assert(void 0!==s);for(const n of e)t.union(s,n)}this.toId=t.toId,this.parents=t.parents,this.id=t.id}),this.add=(t=>{console.assert(void 0===this.toId.get(t)),this.memoizedSets=void 0;const e=++this.id;this.toId.set(t,e);const s=[e,0];return this.parents.set(e,s),s}),this.find=(t=>{const e=this.toId.get(t);if(void 0!==e)return this.findInner(e)}),this.findInner=(t=>{const e=[];let s=t;for(;;){const[t,n]=this.parents.get(s);if(s===t){for(const s of e)this.parents.set(s,[t,n]);return[t,n]}e.push(s),s=t}})}get size(){return this.toId.size}get(t){return n.wrapIt(this.getHelper(t))}*getHelper(t){const e=this.find(t);if(void 0===e)return;const[s]=e;void 0===this.memoizedSets&&(this.memoizedSets=this.aggregate());const n=this.memoizedSets.get(s);if(void 0!==n)for(const t of n)yield t}get structureSize(){return this.parents.size}get garbageRatio(){return 0===this.size?0:this.structureSize/this.size}}e.UnionFind=o},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.groupBy=function(t,e){const s=new Map;for(const n of t){const t=e(n);let o=s.get(t);void 0===o&&(o=[],s.set(t,o)),o.push(n)}return s}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(9),o=s(2),r=s(11),i=s(5);function a(t,e,s){return new Map(o.wrapIt(t).map(t=>{const n=s(...o.wrapIt(e).map(e=>e.get(t)).filter(t=>void 0!==t));return i.makePair(t,n)}))}e.outerJoin=function(t,...e){return a(new Set(n.combine(...e.map(t=>t.keys()))),e,t)},e.leftJoin=function(t,e,...s){return a(e.keys(),[e,...s],t)},e.innerJoin=function(t,...e){return a(r.intersect(...e.map(t=>new Set(t.keys()))),e,t)}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(8),o=s(20),r=s(11);function i(t){return{add:e=>i(t.add(e)),collect:()=>Array.from(t),count:()=>n.wrapIt(t).count(),delete:e=>t.delete(e),difference:(...e)=>i(o.difference(t,...e)),every:e=>n.wrapIt(t).every(e),filter:e=>a(n.wrapIt(t).filter(e)),first:()=>n.wrapIt(t).first(),flatMap:e=>n.wrapIt(t).flatMap(e),forEach:e=>n.wrapIt(t).forEach(e),has:e=>t.has(e),intersect:(...e)=>r.intersect(t,...e),map:e=>a(n.wrapIt(t).map(e)),pin:e=>a(n.wrapIt(t).pin(e)),reduce:(e,s)=>n.wrapIt(t).reduce(e,s),get size(){return t.size},some:e=>n.wrapIt(t).some(e),take:e=>a(n.wrapIt(t).take(e)),*[Symbol.iterator](){for(const e of t)yield e}}}function a(t){return i(new Set(t))}e.unionMut=function(t,...e){for(const s of e)t.add(s);return t},e.wrapSet=i,e.makeSet=a},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.difference=function(t,...e){return e.reduce((t,e)=>{const s=new Set(e),n=new Set;for(const e of t)s.has(e)||n.add(e);return n},new Set(t))}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(18);function o(...t){let e=0;for(const s of t)e+=s;return e}e.negate=function(t){const e=new Map;for(const[s,n]of t)e.set(s,-n);return e},e.sum=o,e.average=function(t,...e){return(t+o(...e))/(e.length+1)},e.sumBy=function(t,e){let s=0;for(const n of e)s+=t(n);return s},e.sumMaps=function(...t){return n.outerJoin((...t)=>o(...t),...t)}},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(4)),n(s(23))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(7),o=s(12),r=s(2);class i extends r.MyIterable{constructor(t,e){super(),this.toKey=t,this.cmp=e,this.data=[],this.pendList=[],this.add=((...t)=>(this.pendList.push(...t),this)),this.has=(t=>void 0!==this.search(t)),this.clone=(()=>i.lightWrap(this.getData().slice(),this.toKey,this.cmp)),this.slice=((t,e)=>this.getData().slice(t,e)),this.right=(t=>i.lightWrap(function(t,e,s,o){if(0===t.length)return[];const r=n.lowerBound(t,e,s,o);return t.slice(r)}(this.getData(),t,this.toKey,this.cmp),this.toKey,this.cmp)),this.left=(t=>i.lightWrap(function(t,e,s,o){if(0===t.length)return[];const r=n.upperBound(t,e,s,o);return t.slice(0,r+1)}(this.getData(),t,this.toKey,this.cmp),this.toKey,this.cmp)),this.get=((t,e)=>{const s=void 0===e?this.search(t):this.range(t,e);if(void 0===s)return[];const[n,o]=s;return this.slice(n,o+1)}),this.range=((t,e)=>{if(!this.isEmpty)return n.binarySearchRange(this.getData(),t,e,this.toKey,this.cmp)}),this.countRange=((t,e)=>{if(this.isEmpty)return 0;const s=void 0===e?this.search(t):this.range(t,e);if(void 0===s)return 0;const[n,o]=s;return o-n+1}),this.getAt=(t=>this.getData()[t]),this.deleteAt=((t,e=1)=>(console.assert(e>=0),e>=1&&t>=0&&t<this.size&&this.getData().splice(t,e),this)),this.delete=(t=>{if(this.isEmpty)return this;const e=this.getData(),s=n.binarySearch(e,t,this.toKey,this.cmp);if(void 0===s)return this;const[o,r]=s,i=r-o+1;return console.assert(i>=1),e.splice(o,i),this}),this.search=(t=>n.binarySearch(this.getData(),t,this.toKey,this.cmp)),this.iterate=(()=>this.getData()),this.getData=(()=>{if(this.pendList.length>0){const t=i.sort(this.pendList,this.toKey,this.cmp);this.data=o.mergeK(this.toKey,this.cmp,t,this.data),this.pendList=[]}return this.data})}static wrap(t,e,s){const n=i.sort(Array.from(t),e,s);return i.lightWrap(n,e,s)}static lightWrap(t,e,s){const n=new i(e,s);return n.data=t,n}static sort(t,e,s){return t.sort((t,n)=>s(e(t),e(n)))}get size(){return this.data.length+this.pendList.length}get isEmpty(){return 0===this.size}}e.SortedList=i},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(7)),n(s(14)),n(s(25)),n(s(12)),n(s(26))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.isSorted=function(t,e){return n.wrapIt(t).pin((t,s)=>e(t,s)<=0).every(t=>t)}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(8);e.uniq=function(t,e){return n.wrapIt(function*(t,e){let s,n=!0;for(const o of t){if(n){s=o,n=!1;continue}const t=e(o,s);if(t>0)yield s,s=o;else if(t<0)throw new Error("input iterable is not sorted in ascending order (based on cmp)")}void 0!==s&&(yield s)}(t,e))}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.genBy=function(t){return n.wrapIt(function*(){for(let e=0;;++e)yield t(e)}())}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.repeat=function(t){return n.wrapIt(function*(t){for(;;)yield t}(t))}},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(30)),n(s(31)),n(s(15)),n(s(32)),n(s(33)),n(s(34))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(4),o=s(5);function r(t,e,s,r,i=(()=>0),...a){if(!t.has(r))throw new Error("source is not a node in the graph");if(a.some(e=>!t.has(e)))throw new Error("destination is not a node in the graph");const c=new Set(a);if(c.has(r))return void console.assert(!1,"source and destination are the same, what are you searching for?");const l=0===a.length,h=new Map([[r,0]]),u=new Map,d=n.MinHeap.heapify(([,t],[,e])=>t-e,o.makePair(r,0));for(;!d.isEmpty;){const[t]=d.pop();if(c.has(t)&&(c.delete(t),0===c.size))return{distance:h,parent:u};for(const n of e(t)){const e=h.get(n),o=h.get(t);console.assert(void 0!==o);const r=s(t,n);if(console.assert(void 0!==r),r<=0)throw new Error("weight must be positive (for progress to happen)");const c=o+r;if(void 0!==e&&c>=e)continue;h.set(n,c);const f=l?0:Math.min(...a.map(t=>i(t,n)));if(f<0)throw new Error("heuristic estimate should be non-negative");const p=c+f;d.add([n,p]),u.set(n,t)}}return l?{distance:h,parent:u}:void 0}e.aStar=r,e.aStarAdjList=function(t,e,s,n=(()=>0),...o){return r(new Set(t.keys()),e=>t.get(e),e,s,n,...o)},e.extractPath=function(t,e,s){let n=s;const o=[];if(void 0!==t.get(n))for(;;){if(o.push(n),n===e)return o;n=t.get(n)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.bfsPreOrder=function(t,e,s=1/0){return n.wrapIt(function*(t,e,s){const n=[[t,0]],o=new Set;for(;n.length>0;){const[t,r]=n.shift();yield[t,r],o.add(t);const i=r+1;if(i<=s)for(const s of e(t))o.has(s)||(o.add(s),n.push([s,i]))}}(t,e,s))}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.FloydWarshall=class{constructor(t,e){this.vertices=[...t.keys()],this.verticesIdx=new Map(Array.from(this.vertices).map((t,e)=>[t,e]));const s=t.size,n=new Array(s),o=this.nextMap=new Array(s);for(let t=0;t<s;++t)n[t]=new Array(s).fill(1/0),o[t]=new Array(s),n[t][t]=0;for(const[s,r]of t)for(const t of r){const r=this.verticesIdx.get(s),i=this.verticesIdx.get(t);n[r][i]=e(s,t),o[r][i]=i}for(let t=0;t<s;t++)for(let e=0;e<s;++e)for(let r=0;r<s;r++){const s=n[e][t]+n[t][r];n[e][r]>s&&(n[e][r]=s,o[e][r]=o[e][t])}}next(t,e){const s=this.verticesIdx.get(e),n=this.verticesIdx.get(t),o=this.nextMap[n][s];if(void 0!==o)return this.vertices[o]}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(16);e.kruskalMST=function(t,e,s){const o=new n.UnionFind,r=Array.from(t).reduce((t,s)=>{for(const n of e(s))t.push([s,n]);return t},new Array).sort(([t,e],[n,o])=>s(t,e)-s(n,o)),i=new Map(Array.from(t).map(t=>[t,[]]));for(const[t,e]of r)o.isSameSet(t,e)||(i.get(t).push(e),i.get(e).push(t),o.union(t,e));return i}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(4);e.stableMarriage=function(t,e){const s=function(t,e){const s=new Map;for(const[o,r]of t){const t=n.MinHeap.inPlaceWrap((t,e)=>r(e)-r(t),Array.from(e.keys()).filter(t=>void 0!==r(t)));s.set(o,t)}return s}(t,e),o=new Map,r=Array.from(t.keys());for(;r.length>0;){const t=r.pop(),n=s.get(t);for(;!n.isEmpty;){const s=n.pop(),i=e.get(s),a=i(t);if(void 0===a)continue;const c=o.get(s);if(void 0===c){o.set(s,t);break}if(a>i(c)){o.set(s,t),r.push(c);break}}}return o}},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(36)),n(s(37)),n(s(17)),n(s(18)),n(s(38)),n(s(10))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.BiMap=class extends n.MyIterable{constructor(...t){super(),this.iterate=(()=>this.leftMap.entries()),this.leftMap=new Map(t),this.rightMap=new Map(t.map(([t,e])=>[e,t]))}get size(){return console.assert(this.leftMap.size===this.rightMap.size),this.leftMap.size}set(t,e){return this.leftMap.set(t,e),this.rightMap.set(e,t),this}delete(t){const e=this.leftMap.get(t);return void 0!==e&&this._delete(t,e)}deleteRight(t){const e=this.rightMap.get(t);return void 0!==e&&this._delete(e,t)}get(t){return this.leftMap.get(t)}getLeft(t){return this.rightMap.get(t)}has(t){return this.leftMap.has(t)}hasRight(t){return this.rightMap.has(t)}keys(){return this.leftMap.keys()}values(){return this.leftMap.values()}_delete(t,e){const s=this.leftMap.delete(t),n=this.rightMap.delete(e);return console.assert(s),console.assert(n),!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(10);function o(t){return t.replace(/\s/g,"").toLowerCase()}function*r(t){const e=t.length;for(let s=0;s<e;s++)for(let n=1;n<=e-s;n++)yield t.substr(s,n)}e.Dictionary=class{constructor(){this.dict=new n.Trie}set(t,e,s){const n=o(t);for(const t of r(n))this.dict.getOrSet(Array.from(t),()=>new Map).set(e,s);return this}batchSet(t,e){const s=o(t);for(const t of r(s)){const s=this.dict.getOrSet(Array.from(t),()=>new Map);for(const[t,n]of e)s.set(t,n)}return this}search(t){const e=o(t);return(this.dict.get(Array.from(e))||new Map).entries()}delete(t,e){const s=o(t);let n=!1;for(const t of r(s)){const s=this.dict.get(Array.from(t));if(void 0!==s){const t=s.delete(e);console.assert(n&&t),n=!0}}return n}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(14),o=s(2),r=s(10);class i extends o.MyIterable{constructor(t,...e){super(),this.cmp=t,this.get=(t=>this.data.get(i.sortKey(this.cmp,t))),this.has=(t=>this.data.has(i.sortKey(this.cmp,t))),this.delete=(t=>this.data.delete(i.sortKey(this.cmp,t))),this.set=((t,e)=>this.data.set(i.sortKey(this.cmp,t),e)),this.getOrSet=((t,e)=>this.data.getOrSet(i.sortKey(this.cmp,t),e)),this.keys=(()=>o.wrapIt(this.iterate()).map(([t])=>t)),this.values=(()=>o.wrapIt(this.iterate()).map(([,t])=>t)),this.makeEmpty=(()=>new i(this.cmp)),this.iterate=(()=>i.iterateHelper(this.cmp,this.data)),this.data=new r.Trie(...e.map(([e,s])=>[i.sortKey(t,e),s]))}static*iterateHelper(t,e){const s=Array.from(e).sort(([e],[s])=>n.cmpList(t,e,s));for(const t of s)yield t}get size(){return this.data.size}get isEmpty(){return 0===this.size}}i.sortKey=((t,e)=>e.slice().sort(t)),e.SortedTrie=i},function(t,e,s){"use strict";function n([t,e],[s,n]){return[t-s,e-n]}function o([t,e]){return Math.sqrt(t*t+e*e)}function r(t,e){return o(n(t,e))}function i([t,e],s){return[s*t,s*e]}function a([t,e],[s,n]){return t*n-s*e}function c([t,e],[s,n],[o,r]){const i=Math.max(s,o),a=Math.min(s,o),c=Math.max(n,r),l=Math.min(n,r);return t<=i&&t>=a&&e<=c&&e>=l}var l;function h(t,e,s,o){const i=n(t,s),c=n(e,s),h=r(t,e),u=h*h,d=o*o,f=a(i,c),p=d*u-f*f;return p<0?l.None:p>0?l.Intersection:l.Tangent}Object.defineProperty(e,"__esModule",{value:!0}),e.equal=function([t,e],[s,n]){return t===s&&e===n},e.compare=function([t,e],[s,n]){return t<s?-1:t>s?1:e-n},e.subtract=n,e.add=function([t,e],[s,n]){return[t+s,e+n]},e.norm=o,e.distance=r,e.scalarMult=i,e.manhattanDistance=function(t,e){const[s,o]=n(t,e);return Math.abs(s)+Math.abs(o)},e.project=function(t,e=1){const s=o(t);return console.assert(0!==s,"caller make sure the given vector is not the origin"),i(t,e/s)},e.determinant=a,e.isPointInRect=c,function(t){t[t.None=0]="None",t[t.Tangent=1]="Tangent",t[t.Intersection=2]="Intersection"}(l=e.IntersectionKind||(e.IntersectionKind={})),e.testLineCircleIntersect=h,e.testLineSegmentCircleIntersect=function(t,e,s,n){return c(s,t,e)?h(t,e,s,n):l.None}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.memo=function(t){const e=new Map;return s=>{if(!e.has(s)){const n=t(s);e.set(s,n)}return e.get(s)}},e.memoBy=function(t,e){const s=new Map;return n=>{if(!s.has(n)){const o=e(n);for(const[e,n]of t(o)){if(s.has(e))throw new Error("genRange keys overlap (all keys from keyBy must be mapped to disjoint sets");s.set(e,n)}if(!s.has(n))throw new Error("genRange doesn't cover the target")}return s.get(n)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(13);e.getAndSum=function(t,e,s){const o=n.defaultZero(t.get(e))+s;return t.set(e,o),o},e.updateMap=function(t,e,s){const n=s(t.get(e));return t.set(e,n),n}},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(43)),n(s(44)),n(s(45))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.diamondSquare=function(t,e,s){console.assert(Number.isInteger(Math.log2(e-1)),"nside must be of the form (2^n)+1");const n=new Float32Array(e*e),o=e-1,r=([t,s])=>t>=0&&t<e&&s>=0&&s<e,i=([t,s])=>s*e+t,a=t=>n[i(t)],c=(t,e)=>{const s=i(t);console.assert(e>0),console.assert(0===n[s]),n[s]=e},l=(e,s,n)=>{const o=s.filter(r).map(a),i=o.reduce((t,e)=>t+e,0)/o.length+t()*n;console.assert(Number.isFinite(i)),c(e,i)},h=(t,e)=>{const s=t/2;for(let n=s;n<=o;n+=t)for(let r=s;r<=o;r+=t)l([r,n],[[r-s,n-s],[r+s,n-s],[r-s,n+s],[r+s,n+s]],e)},u=(t,e)=>{const s=t/2;let n=!0;for(let r=0;r<=o;r+=s){const i=n?s:0;n=!n;for(let n=i;n<=o;n+=t)l([n,r],[[n,r-s],[n,r+s],[n-s,r],[n+s,r]],e)}};{c([0,0],t()),c([0,e-1],t()),c([e-1,0],t()),c([e-1,e-1],t());let n=.1;for(let t=o;t>1;n=(t/=2)/e*s)h(t,n),u(t,n)}const d=Math.max(...n),f=Math.min(...n),p=d-f;console.assert(p>0);const m=n.map(t=>(t-f)/p);return console.assert(m.every(t=>t>=0&&t<=1)),m}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(21);e.randomGen=((t,e)=>{if(n.sum(...t.values())>1)throw new Error("probability needs to be positive and less than 1");const s=[],o=[];for(const[e,n]of t){if(n<=0)throw new Error("probability needs to be positive and less than 1");s.push(e),o.push(n)}const r=void 0===e?Math.random:e;return()=>{const t=r();let e=0;for(let n=0;n<o.length;++n)if(t<(e+=o[n]))return s[n]}}),e.randomGenStrict=((t,s,n)=>{if(s.has(t))throw new Error("remain should ∉ probs");const o=e.randomGen(s,n);return()=>{const e=o();return void 0===e?t:e}})},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.shuffleSlice=function(t){return n.wrapIt(function*(t){const e=Array.from(t);if(0!==e.length)for(;;){const t=e.length-1,s=Math.floor(Math.random()*t);if(yield e[s],s===t)return;e[s]=e.pop()}}(t))}},function(t,e,s){"use strict";function n(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),n(s(47)),n(s(20)),n(s(11)),n(s(16)),n(s(19))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(2);e.BiSet=class extends n.MyIterable{constructor(...t){super(),this.leftMap=new Map,this.rightMap=new Map,this.iterate=(()=>this.leftMap.entries());for(const[e,s]of t)this.add(e,s)}get size(){return this.leftMap.size}add(t,e){this.leftMap.set(t,e),this.rightMap.set(e,t)}deleteLeft(t){const e=this.leftMap.get(t);return void 0!==e&&this.deleteHelper(t,e)}deleteRight(t){const e=this.rightMap.get(t);return void 0!==e&&this.deleteHelper(e,t)}getRight(t){return this.leftMap.get(t)}getLeft(t){return this.rightMap.get(t)}hasLeft(t){return this.leftMap.has(t)}hasRight(t){return this.rightMap.has(t)}lefts(){return n.wrapIt(this.leftMap.keys())}rights(){return n.wrapIt(this.rightMap.keys())}deleteHelper(t,e){const s=this.leftMap.delete(t),n=this.rightMap.delete(e);return console.assert(s),console.assert(n),!0}}},function(t,e,s){"use strict";var n=s.w[t.i];t.exports=n;s(6);n.e()}]]);